<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Redis详细笔记-学习Redis看这一篇就够了, 刘民锴的个人博客">
    <meta name="description" content="刘民锴使用hexo和githubpages 搭建的个人博客 主要用于记录学习笔记 和 技术分享">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->

<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', '');
</script>


    <title>Redis详细笔记-学习Redis看这一篇就够了 | 刘民锴的个人博客</title>
    <link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//favicon.png">

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//css/matery.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//css/my.css">

    <script src="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 4.2.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">刘民锴的个人博客</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-sticky-note" style="zoom: 0.6;"></i>
      
      <span>Essay</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">刘民锴的个人博客</div>
        <div class="logo-desc">
            
            刘民锴使用hexo和githubpages 搭建的个人博客 主要用于记录学习笔记 和 技术分享
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-sticky-note"></i>
			
			Essay
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/kaiminliu" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/kaiminliu" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//medias/featureimages/16.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Redis详细笔记-学习Redis看这一篇就够了</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    .toc-fixed .toc-link::before{
        position: fixed!important;/*当toc的位置改为fixed时，.toc-link::before也要改为fixed*/
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Redis/">
                                <span class="chip bg-color">Redis</span>
                            </a>
                        
                            <a href="/tags/NoSQL/">
                                <span class="chip bg-color">NoSQL</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-category">
                                学习笔记
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-11-02
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2020-11-19
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    14.8k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    58 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1><span id="redis-xiang-xi-bi-ji">Redis详细笔记</span><a href="#redis-xiang-xi-bi-ji" class="header-anchor">.</a></h1><blockquote>
<p>笔记记录 B站狂神说Java的Redis课程：<a href="https://www.bilibili.com/video/BV1S54y1R7SB" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1S54y1R7SB</a></p>
</blockquote>
<h2><span id="yi-nosql-gai-shu">一、NoSQL概述</span><a href="#yi-nosql-gai-shu" class="header-anchor">.</a></h2><h3><span id="1-wei-shi-me-yao-shi-yong-nosql">1、为什么要使用NoSQL</span><a href="#1-wei-shi-me-yao-shi-yong-nosql" class="header-anchor">.</a></h3><ul>
<li><p>现在是大数据时代（一般的数据库已经解决不了的数据：大数据（海量存储和并行计算））</p>
<p><strong>SQL =&gt; NoSQL</strong></p>
<blockquote>
<p>1、单机时代（如MySQL）的<strong>瓶颈</strong></p>
</blockquote>
<ul>
<li>数据量太大，一个机器存不下</li>
<li>数据的索引&lt;B+Tree&gt;（MySQL单表300万条数据，一定要建立索引）,一个机器内存放不下</li>
<li>访问量大（MySQL读写混合 – 性能降低），一个服务器承受不了</li>
</ul>
<blockquote>
<p>2、Memcached缓存（减轻服务器的压力） + MySQL + 垂直拆分（读写分离，多个MySQL服务器，有的值负责读，有的值负责写）</p>
</blockquote>
<p>发展过程：①优化数据结构和索引 =&gt; ②文件缓存（涉及IO操作）=&gt; ③Memcached</p>
<blockquote>
<p>3、分库分表 + 水平拆分 + MySQL集群</p>
</blockquote>
</li>
</ul>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130110.png" alt></p>
<ul>
<li>用户的个人信息（社交网络、地理位置、用户日志等）爆发是增长，无法使用关系型数据库去存储，那么需要NoSQL数据库</li>
</ul>
<h3><span id="2-shi-me-shi-nosql">2、什么是NoSQL</span><a href="#2-shi-me-shi-nosql" class="header-anchor">.</a></h3><blockquote>
<h4><span id="not-only-sql-gt-fei-guan-xi-xing-shu-ju-ku">Not Only SQL –&gt; 非关系型数据库</span><a href="#not-only-sql-gt-fei-guan-xi-xing-shu-ju-ku" class="header-anchor">.</a></h4></blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130153.png" alt></p>
<blockquote>
<h4><span id="nosql-te-dian">NoSQL特点</span><a href="#nosql-te-dian" class="header-anchor">.</a></h4></blockquote>
<ol>
<li><p>方便扩展（数据之间没有关系）</p>
</li>
<li><p>大数据高性能（Redis一秒写8万次，读取11万次，NoSQL的缓存记录级，是一种细粒度的缓存，性能比较高）</p>
</li>
<li><p>数据类型是多样性的（不需要事先设计数据库（因为数据量大），随取随用）</p>
</li>
<li><p>传统RDBMS和NoSQL</p>
<ul>
<li><p>传统RDBMS</p>
<ul>
<li>结构化组织</li>
<li>SQL</li>
<li>数据和关系都存在单独的表中</li>
<li>操作，数据定义语言</li>
<li>严格的一致性</li>
<li>基础的事务</li>
<li>…</li>
</ul>
</li>
<li><p>NoSQL</p>
<ul>
<li>不仅仅是SQL</li>
<li>没有固定的查询语句</li>
<li>键值对存储，列存储，文档存储，图形数据库（社交关系）</li>
<li>最终一致性</li>
<li>CAP定理和BASE</li>
<li>高性能，高可用，高可扩</li>
<li>…</li>
</ul>
</li>
</ul>
</li>
</ol>
<h4><span id="liao-jie-3v-3-gao">了解：3V + 3高</span><a href="#liao-jie-3v-3-gao" class="header-anchor">.</a></h4><p>大数据时代的3V：主要是描述问题的</p>
<ol>
<li>海量Volume</li>
<li>多样Variety</li>
<li>实时Velocity</li>
</ol>
<p>大数据时代的3高：主要是对程序的要求</p>
<ol>
<li>高并发</li>
<li>高可拓（集群）</li>
<li>高性能</li>
</ol>
<pre class="line-numbers language-Python"><code class="language-Python">电商网站：
# 1、商品的基本信息
    名称、价格、商家信息：
        关系型数据库： MySQL / Oracle (王坚：阿里去IOE（IBM小型机，Oracle数据库、EMC存储器）)

# 2、商品的描述、评论（文字多）
    文档型数据库：MongoDB

# 3、图片
    分布式文件系统：FastDFS、TFS（淘宝）、GFS（Google）、HDFS（Hadoop）、OSS云存储（阿里云）

# 4、商品的关键字（搜索）
    搜索引擎：solr、ElasticSearch、ISearch（阿里：多隆）

# 5、商品热门的波段信息
    内存数据库：Redis、Tair、Memcached、...

# 6、商品的交易、外部的接口
    三方应用<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3><span id="3-nosql-de-si-da-fen-lei">3、NoSQL的四大分类</span><a href="#3-nosql-de-si-da-fen-lei" class="header-anchor">.</a></h3><h4><span id="1-kv-jian-zhi-dui">1.KV键值对</span><a href="#1-kv-jian-zhi-dui" class="header-anchor">.</a></h4><ul>
<li>新浪：Redis</li>
<li>美团：Redis + Tair</li>
<li>阿里、百度：Redis + Memcached</li>
</ul>
<h4><span id="2-wen-dang-xing-shu-ju-ku-bson-ge-shi">2.文档型数据库（bson格式）</span><a href="#2-wen-dang-xing-shu-ju-ku-bson-ge-shi" class="header-anchor">.</a></h4><ul>
<li>MongoDB（必须掌握）<ul>
<li>基于分布式文件存储的数据库（C++编写）</li>
<li>主要用于处理大量的文档</li>
<li>介于关系型数据库和非关系型数据库中的中间产品</li>
</ul>
</li>
<li>ConthDB</li>
</ul>
<h4><span id="3-lie-shi-cun-chu">3.列式存储</span><a href="#3-lie-shi-cun-chu" class="header-anchor">.</a></h4><ul>
<li>HBase</li>
<li>分布式文件系统</li>
</ul>
<h4><span id="4-tu-guan-xi-shu-ju-ku">4.图关系数据库</span><a href="#4-tu-guan-xi-shu-ju-ku" class="header-anchor">.</a></h4><ul>
<li>存关系的，不是存图片的（比如，朋友圈社交网络，广告推荐）</li>
<li>Neo4j、InfoGrid</li>
</ul>
<h4><span id="dui-bi">对比</span><a href="#dui-bi" class="header-anchor">.</a></h4><table>
<thead>
<tr>
<th><strong>分类</strong></th>
<th><strong>Examples举例</strong></th>
<th><strong>典型应用场景</strong></th>
<th><strong>数据模型</strong></th>
<th><strong>优点</strong></th>
<th><strong>缺点</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>键值（key-value）</strong></td>
<td>Tokyo<br>Cabine/Tyrant<br>Redis<br>Voldemort<br>Oracle BDB</td>
<td><strong>内容缓存</strong>，主要用于处理大量数据的高访问负载，也用于一些<strong>日志系统</strong>等等</td>
<td>Key指向Value的键值对，通常用hashtable来实现</td>
<td>查找速度快</td>
<td>数据无结构化，通常只被当作字符串或者二进制数据</td>
</tr>
<tr>
<td><strong>列存储数据库</strong></td>
<td>Cassandra<br>HBase<br>Riak</td>
<td>分布式的文件系统</td>
<td>以列簇式存储，将同一列数据存在一起</td>
<td>查找速度快，可扩展性强，更容易进行分布式扩展</td>
<td>功能相对局限</td>
</tr>
<tr>
<td><strong>文档型数据库</strong></td>
<td>CouchDB<br>MongoDB</td>
<td>Web应用（与Key-Value类似，Value是结构化的，不同的是数据库能够了解Value的内容）</td>
<td>Key-Value对应的键值对，Value为结构化数据</td>
<td>数据结构要求不严谨，表结构可变，不需要像关系型数据库一样需要预先定义表结构</td>
<td>查询性能不高，而且缺乏统一的查询语法</td>
</tr>
<tr>
<td><strong>图形数据库</strong></td>
<td>Neo4J<br>InfoGrid<br>Infinite Graph</td>
<td>社交网络，推荐系统等。专注于构建关系图谱</td>
<td>图结构</td>
<td>利用图结构相关算法。比如最短路径寻址，N度关系查找等</td>
<td>很多时候需要对整个图做计算才能得出需要的信息，而且这种结构不太好做分布式的集群方案</td>
</tr>
</tbody></table>
<h2><span id="er-redis-ru-men">二、Redis入门</span><a href="#er-redis-ru-men" class="header-anchor">.</a></h2><h3><span id="1-redis-shi-shi-me">1.Redis是什么</span><a href="#1-redis-shi-shi-me" class="header-anchor">.</a></h3><blockquote>
<p>官网：<a href="redis.io">redis.io</a></p>
<p>中文网：<a href="http://www.redis.cn/" target="_blank" rel="noopener">http://www.redis.cn/</a></p>
<p>Redis 是一个开源（BSD许可）的，内存中的数据结构存储系统，它可以用作<mark>数据库</mark>、<mark>缓存</mark>和<mark>消息中间件</mark>。 它支持多种类型的数据结构，如 <a href="http://www.redis.cn/topics/data-types-intro.html#strings" target="_blank" rel="noopener">字符串（strings）</a>， <a href="http://www.redis.cn/topics/data-types-intro.html#hashes" target="_blank" rel="noopener">散列（hashes）</a>， <a href="http://www.redis.cn/topics/data-types-intro.html#lists" target="_blank" rel="noopener">列表（lists）</a>， <a href="http://www.redis.cn/topics/data-types-intro.html#sets" target="_blank" rel="noopener">集合（sets）</a>， <a href="http://www.redis.cn/topics/data-types-intro.html#sorted-sets" target="_blank" rel="noopener">有序集合（sorted sets）</a> 与范围查询， <a href="http://www.redis.cn/topics/data-types-intro.html#bitmaps" target="_blank" rel="noopener">bitmaps</a>， <a href="http://www.redis.cn/topics/data-types-intro.html#hyperloglogs" target="_blank" rel="noopener">hyperloglogs</a> 和 <a href="http://www.redis.cn/commands/geoadd.html" target="_blank" rel="noopener">地理空间（geospatial）</a> 索引半径查询。 Redis 内置了 <a href="http://www.redis.cn/topics/replication.html" target="_blank" rel="noopener">复制（replication）</a>，<a href="http://www.redis.cn/commands/eval.html" target="_blank" rel="noopener">LUA脚本（Lua scripting）</a>， <a href="http://www.redis.cn/topics/lru-cache.html" target="_blank" rel="noopener">LRU驱动事件（LRU eviction）</a>，<a href="http://www.redis.cn/topics/transactions.html" target="_blank" rel="noopener">事务（transactions）</a> 和不同级别的 <a href="http://www.redis.cn/topics/persistence.html" target="_blank" rel="noopener">磁盘持久化（persistence）</a>， 并通过 <a href="http://www.redis.cn/topics/sentinel.html" target="_blank" rel="noopener">Redis哨兵（Sentinel）</a>和自动 <a href="http://www.redis.cn/topics/cluster-tutorial.html" target="_blank" rel="noopener">分区（Cluster）</a>提供高可用性（high availability）。</p>
</blockquote>
<h4><span id="redis-yu-qi-ta-key-value-huan-cun-chan-pin-you-yi-xia-san-ge-te-dian">Redis 与其他 key - value 缓存产品有以下三个特点：</span><a href="#redis-yu-qi-ta-key-value-huan-cun-chan-pin-you-yi-xia-san-ge-te-dian" class="header-anchor">.</a></h4><ol>
<li>Redis<strong>支持数据的持久化</strong>，可以将内存中的数据保存在磁盘中，重启的时候可以再次加载进行使用。</li>
<li>Redis不仅仅支持简单的key-value类型的数据，同时还提供list，set，zset，hash等数据结构的存储（<strong>多样的数据结构</strong>）。</li>
<li>Redis支持数据的备份，即<strong>master-slave模式的数据备份</strong>。</li>
</ol>
<h4><span id="redis-you-shi">Redis优势</span><a href="#redis-you-shi" class="header-anchor">.</a></h4><ol>
<li><strong>性能极高</strong> – Redis能读的速度是110000次/s,写的速度是81000次/s 。</li>
<li><strong>丰富的数据类型</strong> – Redis支持二进制案例的 Strings, Lists, Hashes, Sets 及 Ordered Sets 数据类型操作。</li>
<li><strong>原子</strong> – Redis的所有操作都是原子性的，意思就是要么成功执行要么失败完全不执行。单个操作是原子性的。多个操作也支持事务，即原子性，通过MULTI和EXEC指令包起来。（<strong>但是Redis事务多操作不支持原子性–当我们执行后有语句有错，其他语句仍然可以正常执行</strong>，<mark>详情看事务</mark>）</li>
<li><strong>丰富的特性</strong> – Redis还支持 publish/subscribe, 通知, key 过期等等特性。</li>
<li>Redis运行在内存中但是可以<strong>持久化</strong>到磁盘，所以在对不同数据集进行高速读写时需要权衡内存，因为数据量不能大于硬件内存。在内存数据库方面的另一个优点是，相<strong>比在磁盘上相同的复杂的数据结构，在内存中操作起来非常简单</strong>，这样Redis可以做很多内部复杂性很强的事情。同时，<strong>在磁盘格式方面他们是紧凑的以追加的方式产生的，因为他们并不需要进行随机访问</strong>。</li>
</ol>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130236.png" alt></p>
<h3><span id="2-neng-gan-shi-me">2.能干什么？</span><a href="#2-neng-gan-shi-me" class="header-anchor">.</a></h3><ul>
<li>内存存储、<strong>持久化（rdb，aof）</strong></li>
<li>效率高、可以用于高速缓存</li>
<li>发布订阅系统</li>
<li>地图信息分析</li>
<li>计时器、计数器（浏览量）</li>
<li>…</li>
</ul>
<h3><span id="3-te-xing">3.特性</span><a href="#3-te-xing" class="header-anchor">.</a></h3><ul>
<li>多样的数据结构</li>
<li>持久化</li>
<li>集群</li>
<li>事务</li>
<li>…</li>
</ul>
<h3><span id="4-an-zhuang-yin-wei-redis-geng-gua-he-zai-linux-xia-shi-yong-suo-yi-zhi-you-linux-de-an-zhuang-ban-ben">4.安装（因为Redis更适合在linux下使用，所以只有linux的安装版本）</span><a href="#4-an-zhuang-yin-wei-redis-geng-gua-he-zai-linux-xia-shi-yong-suo-yi-zhi-you-linux-de-an-zhuang-ban-ben" class="header-anchor">.</a></h3><blockquote>
<p>linux 使用的系统是 Centos 7.3</p>
<p>你可使用 虚拟机，也可已使用云服务器（学生机不贵），因为我有服务器，这里就在服务器上安装和学习Redis</p>
</blockquote>
<p>①下载安装包</p>
<p><a href="http://www.redis.cn/" target="_blank" rel="noopener">http://www.redis.cn/</a></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130247.png" alt></p>
<p>②加压安装包（提前使用xshell和xftp上传压缩包到服务器上）</p>
<blockquote>
<p>压缩包在 /app/目录下</p>
</blockquote>
<p>在/usr/local/ 下创建redis文件夹，并进入到文件夹中</p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130258.png" alt></p>
<p>解压压缩包到该文件夹下</p>
<pre class="line-numbers language-bash"><code class="language-bash"> <span class="token function">tar</span> -zxvf /app/redis-6.0.6.tar.gz -C ./<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130303.png" alt></p>
<p>③编译并安装（保证安装了编译环境）</p>
<blockquote>
<p>没有安装编译环境，需要 yum install gcc-c++</p>
</blockquote>
<blockquote>
<p>如果下面操作报错：需要提升GCC的版本（redis6需要5.3+）</p>
<pre class="line-numbers language-bash"><code class="language-bash">//升级gcc到9以上
yum -y <span class="token function">install</span> centos-release-scl
yum -y <span class="token function">install</span> devtoolset-9-gcc devtoolset-9-gcc-c++ devtoolset-9-binutils

//临时将此时的gcc版本改为9
scl <span class="token function">enable</span> devtoolset-9 <span class="token function">bash</span>
//或永久改变
<span class="token keyword">echo</span> <span class="token string">"source /opt/rh/devtoolset-9/enable"</span> <span class="token operator">>></span>/etc/profile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">cd</span> redis-6.0.6

<span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130308.png" alt></p>
<p>编译后，默认安装路径在 <code>/usr/local/bin</code></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130313.png" alt></p>
<p>④安装系统服务并后台启动</p>
<blockquote>
<p>可能会报错：</p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130318.png" alt></p>
<p>解决方法：vim install_server.sh，注释如下图内容</p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130327.png" alt></p>
</blockquote>
<p><strong>安装系统服务</strong>（可以指定选项，下面默认）</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">cd</span> utils
./install_server.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130336.png" alt></p>
<blockquote>
<p>默认的配置文件：/etc/redis/6379.conf（安装成功后，默认后台自启）</p>
</blockquote>
<p>⑤开启redis服务</p>
<blockquote>
<p>可以使用自定义的配置文件开启，这里使用systemctl</p>
<pre class="line-numbers language-bash"><code class="language-bash">/redis安装目录/redis-server    /配置文件目录/redis.conf
<span class="token comment" spellcheck="true"># 关闭服务</span>
/redis安装目录/redis-cli <span class="token function">shutdown</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash">systemctl start redis_6379.service<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130344.png" alt></p>
<p>⑥客户端连接测试</p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130348.png" alt></p>
<p>⑦设置远程连接</p>
<pre class="line-numbers language-bash"><code class="language-bash">vim /etc/redis/6379.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130353.png" alt></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130357.png" alt="关闭保护模式"></p>
<blockquote>
<p>然后重启服务即可：</p>
<pre class="line-numbers language-bash"><code class="language-bash">systemctl restart redis_6379.service<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</blockquote>
<p>⑧配置访问密码</p>
<pre class="line-numbers language-bash"><code class="language-bash">vim /etc/redis/6379.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130401.png" alt></p>
<p>重启服务</p>
<pre class="line-numbers language-bash"><code class="language-bash">systemctl restart redis_6379.service<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>客户端连接测试</p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130407.png" alt></p>
<p>关闭连接</p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130411.png" alt></p>
<h3><span id="5-xing-neng-ce-shi">5.性能测试</span><a href="#5-xing-neng-ce-shi" class="header-anchor">.</a></h3><blockquote>
<p>使用自带的<code>redis-benchmark</code>工具测试即可</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash">redis-benchmark <span class="token punctuation">[</span>option<span class="token punctuation">]</span> <span class="token punctuation">[</span>option value<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>性能测试工具可选参数：</strong></p>
<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">选项</th>
<th align="left">描述</th>
<th align="left">默认值</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><strong>-h</strong></td>
<td align="left">指定服务器主机名</td>
<td align="left">127.0.0.1</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><strong>-p</strong></td>
<td align="left">指定服务器端口</td>
<td align="left">6379</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><strong>-s</strong></td>
<td align="left">指定服务器 socket</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><strong>-c</strong></td>
<td align="left">指定并发连接数</td>
<td align="left">50</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><strong>-n</strong></td>
<td align="left">指定请求数</td>
<td align="left">10000</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><strong>-d</strong></td>
<td align="left">以字节的形式指定 SET/GET 值的数据大小</td>
<td align="left">3</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><strong>-k</strong></td>
<td align="left">1=keep alive 0=reconnect</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><strong>-r</strong></td>
<td align="left">SET/GET/INCR 使用随机 key, SADD 使用随机值</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><strong>-P</strong></td>
<td align="left">通过管道传输 &lt;numreq&gt; 请求</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><strong>-q</strong></td>
<td align="left">强制退出 redis。仅显示 query/sec 值</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><strong>–csv</strong></td>
<td align="left">以 CSV 格式输出</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><strong>-l</strong></td>
<td align="left">生成循环，永久执行测试</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><strong>-t</strong></td>
<td align="left">仅运行以逗号分隔的测试命令列表。</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">14</td>
<td align="left"><strong>-I</strong></td>
<td align="left">Idle 模式。仅打开 N 个 idle 连接并等待。</td>
<td align="left"></td>
</tr>
</tbody></table>
<h4><span id="ce-shi">测试</span><a href="#ce-shi" class="header-anchor">.</a></h4><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 测试：100个并发连接  100000请求</span>
redis-benchmark -c 100 -n 100000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130417.png" alt></p>
<h3><span id="6-ji-ben-zhi-shi-shuo-ming-ji-ben-ming-ling">6.基本知识说明（基本命令）</span><a href="#6-ji-ben-zhi-shi-shuo-ming-ji-ben-ming-ling" class="header-anchor">.</a></h3><blockquote>
<p>如果觉得这里命令不太好看，去这个博客<a href="https://www.cnblogs.com/wlandwl/p/redis.html，或者" target="_blank" rel="noopener">https://www.cnblogs.com/wlandwl/p/redis.html，或者</a> 官网：<a href="http://www.redis.cn/commands.html" target="_blank" rel="noopener">http://www.redis.cn/commands.html</a></p>
</blockquote>
<p><strong>注意：以下的所有key都表示对应数据类型的 <code>键的名称</code> ； value表示<code>存储的值</code>(除非注释中有特殊说明)</strong></p>
<h4><span id="1-redis-you-16-ge-shu-ju-ku-0-15-mo-ren-shi-yong-di-0-ge">1.Redis 有16个数据库（0~15），默认使用第0个</span><a href="#1-redis-you-16-ge-shu-ju-ku-0-15-mo-ren-shi-yong-di-0-ge" class="header-anchor">.</a></h4><blockquote>
<p>可以使用 <code>select</code>进行切换</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130423.png" alt></p>
<h4><span id="2-cha-kan-shu-ju-ku-da-xiao">2.查看数据库大小</span><a href="#2-cha-kan-shu-ju-ku-da-xiao" class="header-anchor">.</a></h4><blockquote>
<p>使用 <code>dbsize</code>查看数据库大小</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130427.png" alt></p>
<h4><span id="3-cha-kan-suo-you-de-key-dang-qian-ku">3.查看所有的key（当前库）</span><a href="#3-cha-kan-suo-you-de-key-dang-qian-ku" class="header-anchor">.</a></h4><blockquote>
<p>使用 <code>keys *</code></p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130431.png" alt></p>
<h4><span id="4-qing-chu-dang-qian-shu-ju-ku">4.清除当前数据库</span><a href="#4-qing-chu-dang-qian-shu-ju-ku" class="header-anchor">.</a></h4><blockquote>
<p><code>flushdb</code></p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130435.png" alt></p>
<h4><span id="5-qing-kong-suo-you-shu-ju-ku">5.清空所有数据库</span><a href="#5-qing-kong-suo-you-shu-ju-ku" class="header-anchor">.</a></h4><blockquote>
<p><code>flushall</code></p>
</blockquote>
<p>略</p>
<h4><span id="6-redis-shi-dan-xian-cheng-de">6.Redis是单线程的？</span><a href="#6-redis-shi-dan-xian-cheng-de" class="header-anchor">.</a></h4><ul>
<li>Redis是很快的，官方表示，Redis是基于内存操作，CPU不是Redis的性能瓶颈，<strong>Redis的性能瓶颈是根据机器的<mark>内存</mark>和<mark>网络的带宽</mark></strong>，既然可以使用单线程，就不用使用多线程。(<mark>6.0后支持多线程</mark>)</li>
</ul>
<p><img src="/2020/11/02/9349/image-20201112020411584.png" alt="6.0另当别论"></p>
<h4><span id="7-pan-duan-key-shi-fou-cun-zai">7.判断key是否存在</span><a href="#7-pan-duan-key-shi-fou-cun-zai" class="header-anchor">.</a></h4><blockquote>
<p><code>exists</code> key</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130441.png" alt></p>
<h4><span id="8-yi-chu-key">8.移除key</span><a href="#8-yi-chu-key" class="header-anchor">.</a></h4><blockquote>
<p><code>move</code> key 1 // 1表示当前数据库  </p>
<p><code>del</code>  key  // 删除当前数据库的key（可以多个）</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130447.png" alt></p>
<h4><span id="9-she-zhi-key-de-guo-qi-shi-jian">9.设置key的过期时间</span><a href="#9-she-zhi-key-de-guo-qi-shi-jian" class="header-anchor">.</a></h4><blockquote>
<p><code>expire</code> key 时间  // 单位时间为s</p>
<p><code>ttl</code> key  // 查看剩余存活时间</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130453.png" alt></p>
<h4><span id="10-cha-kan-dang-qian-key-de-lei-xing">10.查看当前key的类型</span><a href="#10-cha-kan-dang-qian-key-de-lei-xing" class="header-anchor">.</a></h4><blockquote>
<p><code>type</code> key</p>
</blockquote>
<h4><span id="11-zi-fu-chuan-zhui-jia-string">11.字符串追加（String）</span><a href="#11-zi-fu-chuan-zhui-jia-string" class="header-anchor">.</a></h4><blockquote>
<p><code>append</code> key appendValue</p>
</blockquote>
<ul>
<li><mark>如果当前 key 不存在，作用相当于 set key</mark></li>
</ul>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130458.png" alt></p>
<h4><span id="12-huo-qu-zi-fu-chuan-chang-du-string">12.获取字符串长度（String）</span><a href="#12-huo-qu-zi-fu-chuan-chang-du-string" class="header-anchor">.</a></h4><blockquote>
<p><code>strlen</code>  key</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130502.png" alt></p>
<h4><span id="13-zi-fu-chuan-i-cao-zuo-ke-yong-yu-yue-du-liang-shi-xian-string">13.字符串i++操作（可用于阅读量实现）（String）</span><a href="#13-zi-fu-chuan-i-cao-zuo-ke-yong-yu-yue-du-liang-shi-xian-string" class="header-anchor">.</a></h4><blockquote>
<p><code>incr</code> key</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130506.png" alt></p>
<h5><span id="tong-li-i">同理，i–</span><a href="#tong-li-i" class="header-anchor">.</a></h5><blockquote>
<p><code>decr</code> key</p>
</blockquote>
<h5><span id="bu-chang-she-zhi">步长设置</span><a href="#bu-chang-she-zhi" class="header-anchor">.</a></h5><blockquote>
<p><code>incrby</code> key 步长</p>
<p><code>decrby</code> key 步长</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130509.png" alt></p>
<h4><span id="14-zi-fu-chuan-pian-duan-range-string">14.字符串片段 Range （String）</span><a href="#14-zi-fu-chuan-pian-duan-range-string" class="header-anchor">.</a></h4><blockquote>
<p><code>getrange</code> key startIndex endIndex  </p>
</blockquote>
<ul>
<li><strong>对应java里的substring</strong>（<mark>但是这里会endIndex是一个闭区间</mark>）</li>
<li>特例，endIndex = -1 时，表示从startIndex 到最后</li>
</ul>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130513.png" alt></p>
<h4><span id="15-zi-fu-chuan-ti-huan-string">15.字符串替换 （String）</span><a href="#15-zi-fu-chuan-ti-huan-string" class="header-anchor">.</a></h4><blockquote>
<p><code>setrange</code> key  index  replaceString </p>
</blockquote>
<ul>
<li><strong>对应java里的replace</strong></li>
<li>注意，如果replaceString是一个字符串，那么会替换源字符串中index后replaceString长度的片段，结果如下</li>
</ul>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130517.png" alt></p>
<h4><span id="16-te-shu-set-she-zhi-string">16.特殊set设置 （String）</span><a href="#16-te-shu-set-she-zhi-string" class="header-anchor">.</a></h4><h5><span id="setex-set-with-expire">setex（set with expire）</span><a href="#setex-set-with-expire" class="header-anchor">.</a></h5><blockquote>
<p><code>setex</code>   key  时间  value  // 设置值，带过期时间</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130520.png" alt></p>
<h5><span id="setnx-set-if-not-exist">setnx（set if not exist）</span><a href="#setnx-set-if-not-exist" class="header-anchor">.</a></h5><blockquote>
<p><code>setnx</code>   key  value // 如果不存在，则设置</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130524.png" alt></p>
<h4><span id="17-pi-liang-she-zhi-pi-liang-huo-qu-yuan-zi-xing-cao-zuo-string">17.批量设置、批量获取（原子性操作） （String）</span><a href="#17-pi-liang-she-zhi-pi-liang-huo-qu-yuan-zi-xing-cao-zuo-string" class="header-anchor">.</a></h4><blockquote>
<p><code>mset</code>  k1  v1  k2  v2  …</p>
</blockquote>
<blockquote>
<p><code>mget</code>  k1  k2 …</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130527.png" alt></p>
<ul>
<li><strong>特殊</strong><ul>
<li><code>msetnx</code> 批量设置</li>
</ul>
</li>
</ul>
<h4><span id="18-she-zhi-gao-jie-string">18.设置高阶 （String）</span><a href="#18-she-zhi-gao-jie-string" class="header-anchor">.</a></h4><h5><span id="1-getset">1）getset</span><a href="#1-getset" class="header-anchor">.</a></h5><blockquote>
<p><code>getset</code>  key  value  // 先get再set（如果不存在，先返回nil，在设置值；如果存在，就先返回原值，再设置新值）</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130531.png" alt></p>
<h4><span id="19-chong-ming-ming-key">19.重命名key</span><a href="#19-chong-ming-ming-key" class="header-anchor">.</a></h4><blockquote>
<p><code>rename</code>   key   newName</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130541.png" alt></p>
<h4><span id="20-fan-hui-yi-ge-sui-ji-key">20.返回一个随机key</span><a href="#20-fan-hui-yi-ge-sui-ji-key" class="header-anchor">.</a></h4><blockquote>
<p><code>randomKey</code></p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130548.png" alt></p>
<h4><span id="21-shou-dong-chi-jiu-hua-cao-zuo">21.手动持久化操作</span><a href="#21-shou-dong-chi-jiu-hua-cao-zuo" class="header-anchor">.</a></h4><blockquote>
<p><code>save</code>  阻塞</p>
</blockquote>
<ul>
<li>SAVE 直接调用 rdbSave ，阻塞 Redis 主进程，直到保存完成为止。在主进程阻塞期间，服务器不能处理客户端的任何请求。</li>
</ul>
<blockquote>
<p><code>bgsave</code> 非阻塞</p>
</blockquote>
<ul>
<li>BGSAVE 则 fork 出一个子进程，子进程负责调用 rdbSave ，并在保存完成之后向主进程发送信号，通知保存已完成。 Redis 服务器在BGSAVE 执行期间仍然可以继续处理客户端的请求。</li>
</ul>
<table>
<thead>
<tr>
<th>命令</th>
<th>save</th>
<th>bgsave</th>
</tr>
</thead>
<tbody><tr>
<td>IO类型</td>
<td>同步</td>
<td>异步</td>
</tr>
<tr>
<td>阻塞？</td>
<td>是</td>
<td>是（阻塞发生在fock()，通常非常快）</td>
</tr>
<tr>
<td>复杂度</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
<tr>
<td>优点</td>
<td>不会消耗额外的内存</td>
<td>不阻塞客户端命令</td>
</tr>
<tr>
<td>缺点</td>
<td>阻塞客户端命令</td>
<td>需要fock子进程，消耗内存</td>
</tr>
</tbody></table>
<h4><span id="22-huo-qu-pei-zhi-wen-jian-zhong-yong-hu-mi-ma">22.获取配置文件中用户密码</span><a href="#22-huo-qu-pei-zhi-wen-jian-zhong-yong-hu-mi-ma" class="header-anchor">.</a></h4><blockquote>
<p><code>config get requirepass</code></p>
</blockquote>
<h4><span id="23-she-zhi-pei-zhi-wen-jian-zhong-yong-hu-mi-ma-lin-shi-chong-qi-fu-wu-shi-xiao">23.设置配置文件中用户密码（临时，重启服务失效）</span><a href="#23-she-zhi-pei-zhi-wen-jian-zhong-yong-hu-mi-ma-lin-shi-chong-qi-fu-wu-shi-xiao" class="header-anchor">.</a></h4><blockquote>
<p><code>config set requirepass  password</code></p>
</blockquote>
<h4><span id="24-mi-ma-ren-zheng">24.密码认证</span><a href="#24-mi-ma-ren-zheng" class="header-anchor">.</a></h4><blockquote>
<p><code>auth password</code> 设置密码后必须认证才能使用客户端功能</p>
</blockquote>
<h4><span id="25-guan-bi-redis-fu-wu">25.关闭redis服务</span><a href="#25-guan-bi-redis-fu-wu" class="header-anchor">.</a></h4><blockquote>
<p><code>shutdown</code></p>
</blockquote>
<h4><span id="26-cha-kan-rdb-wen-jian-cun-fang-de-mu-lu">26.<strong>查看rdb文件存放的目录</strong></span><a href="#26-cha-kan-rdb-wen-jian-cun-fang-de-mu-lu" class="header-anchor">.</a></h4><p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130556.png" alt></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130600.png" alt></p>
<h4><span id="27-cha-kan-fu-wu-qi-de-xin-xi">27.查看服务器的信息</span><a href="#27-cha-kan-fu-wu-qi-de-xin-xi" class="header-anchor">.</a></h4><blockquote>
<p><code>info</code>  参数</p>
</blockquote>
<p>参数列表：</p>
<ul>
<li><code>server</code>: Redis服务器的一般信息</li>
<li><code>clients</code>: 客户端的连接部分</li>
<li><code>memory</code>: 内存消耗相关信息</li>
<li><code>persistence</code>: RDB和AOF相关信息</li>
<li><code>stats</code>: 一般统计</li>
<li><code>replication</code>: 主/从复制信息</li>
<li><code>cpu</code>: 统计CPU的消耗</li>
<li><code>commandstats</code>: Redis命令统计</li>
<li><code>cluster</code>: Redis集群信息</li>
<li><code>keyspace</code>: 数据库的相关统计</li>
</ul>
<p>它也可以采取以下值:</p>
<ul>
<li><code>all</code>: 返回所有信息</li>
<li><code>default</code>: 值返回默认设置的信息</li>
</ul>
<p>如果没有使用任何参数时，默认为<code>default</code>。</p>
<h2><span id="san-wu-da-shu-ju-lei-xing">三、五大数据类型</span><a href="#san-wu-da-shu-ju-lei-xing" class="header-anchor">.</a></h2><p>Redis 是一个开源（BSD许可）的，内存中的数据结构存储系统，它可以用作<mark>数据库</mark>、<mark>缓存</mark>和<mark>消息中间件</mark>。 它支持多种类型的数据结构，如 <a href="http://www.redis.cn/topics/data-types-intro.html#strings" target="_blank" rel="noopener">字符串（strings）</a>， <a href="http://www.redis.cn/topics/data-types-intro.html#hashes" target="_blank" rel="noopener">散列（hashes）</a>， <a href="http://www.redis.cn/topics/data-types-intro.html#lists" target="_blank" rel="noopener">列表（lists）</a>， <a href="http://www.redis.cn/topics/data-types-intro.html#sets" target="_blank" rel="noopener">集合（sets）</a>， <a href="http://www.redis.cn/topics/data-types-intro.html#sorted-sets" target="_blank" rel="noopener">有序集合（sorted sets）</a> 与范围查询， <a href="http://www.redis.cn/topics/data-types-intro.html#bitmaps" target="_blank" rel="noopener">bitmaps</a>， <a href="http://www.redis.cn/topics/data-types-intro.html#hyperloglogs" target="_blank" rel="noopener">hyperloglogs</a> 和 <a href="http://www.redis.cn/commands/geoadd.html" target="_blank" rel="noopener">地理空间（geospatial）</a> 索引半径查询。 Redis 内置了 <a href="http://www.redis.cn/topics/replication.html" target="_blank" rel="noopener">复制（replication）</a>，<a href="http://www.redis.cn/commands/eval.html" target="_blank" rel="noopener">LUA脚本（Lua scripting）</a>， <a href="http://www.redis.cn/topics/lru-cache.html" target="_blank" rel="noopener">LRU驱动事件（LRU eviction）</a>，<a href="http://www.redis.cn/topics/transactions.html" target="_blank" rel="noopener">事务（transactions）</a> 和不同级别的 <a href="http://www.redis.cn/topics/persistence.html" target="_blank" rel="noopener">磁盘持久化（persistence）</a>， 并通过 <a href="http://www.redis.cn/topics/sentinel.html" target="_blank" rel="noopener">Redis哨兵（Sentinel）</a>和自动 <a href="http://www.redis.cn/topics/cluster-tutorial.html" target="_blank" rel="noopener">分区（Cluster）</a>提供高可用性（high availability）。</p>
<p><mark>单点登录、</mark></p>
<h3><span id="string-zi-fu-chuan">String（字符串）</span><a href="#string-zi-fu-chuan" class="header-anchor">.</a></h3><p>略，具体看前面</p>
<h4><span id="shi-yong-chang-jing">使用场景：</span><a href="#shi-yong-chang-jing" class="header-anchor">.</a></h4><ol>
<li>计数器</li>
<li>统计多单位的数量（uid:122:follow 10）</li>
<li>粉丝数</li>
<li>对象缓存存储</li>
</ol>
<hr>
<h3><span id="list-lie-biao">List（列表）</span><a href="#list-lie-biao" class="header-anchor">.</a></h3><h4><span id="1-cong-tou-bu-wei-bu-cha-ru-shu-ju-yi-ji-shu-ju-xian-shi">1.从头部/尾部<mark>插入</mark>数据，以及数据<mark>显示</mark></span><a href="#1-cong-tou-bu-wei-bu-cha-ru-shu-ju-yi-ji-shu-ju-xian-shi" class="header-anchor">.</a></h4><blockquote>
<p><code>lpush</code>  key  value</p>
<p><code>rpush</code>  key  value</p>
<p><code>lrange</code>  key  0  -1</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130607.png" alt></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130610.png" alt></p>
<h4><span id="2-cong-tou-bu-wei-bu-yi-chu-shu-ju">2.从头部/尾部<mark>移除</mark>数据</span><a href="#2-cong-tou-bu-wei-bu-yi-chu-shu-ju" class="header-anchor">.</a></h4><blockquote>
<p><code>lpop</code>  key  </p>
<p><code>rpop</code>  key  </p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130614.png" alt></p>
<h4><span id="3-huo-qu-zhi-ding-suo-yin-de-zhi">3.<mark>获取</mark>指定索引的值</span><a href="#3-huo-qu-zhi-ding-suo-yin-de-zhi" class="header-anchor">.</a></h4><blockquote>
<p><code>lindex</code>   key  index</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130617.png" alt></p>
<h4><span id="4-huo-qu-lie-biao-chang-du">4.获取列表长度</span><a href="#4-huo-qu-lie-biao-chang-du" class="header-anchor">.</a></h4><blockquote>
<p><code>llen</code>  key  </p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130623.png" alt="image-20201112171308314"></p>
<h4><span id="5-yi-chu-zhi-ding-de-zhi">5.移除指定的值</span><a href="#5-yi-chu-zhi-ding-de-zhi" class="header-anchor">.</a></h4><blockquote>
<p><code>lrem</code>   key  count(移除的个数)  element  </p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130627.png" alt></p>
<h4><span id="6-lie-biao-xiu-jian-trim">6.列表修剪 trim</span><a href="#6-lie-biao-xiu-jian-trim" class="header-anchor">.</a></h4><blockquote>
<p><code>ltrim</code>  key  startIndex  endIndex  </p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130632.png" alt></p>
<h4><span id="7-ye-ke-yi-shi-yong-set">7.也可以使用set</span><a href="#7-ye-ke-yi-shi-yong-set" class="header-anchor">.</a></h4><blockquote>
<p><code>lset</code>   key   index   value  // 将列表中 指定index的值替换为对应的value</p>
</blockquote>
<ul>
<li>需要保证key和index都存在，否则报错</li>
</ul>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130638.png" alt></p>
<h4><span id="8-cha-ru-zhi-ding-de-zhi">8.插入指定的值</span><a href="#8-cha-ru-zhi-ding-de-zhi" class="header-anchor">.</a></h4><blockquote>
<p><code>linsert</code>   key   before|after   pivot(那个单词后)   value </p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130644.png" alt></p>
<h4><span id="9-fu-za-cao-zuo">9.复杂操作</span><a href="#9-fu-za-cao-zuo" class="header-anchor">.</a></h4><h5><span id="1-rpoplpush">1）rpoplpush</span><a href="#1-rpoplpush" class="header-anchor">.</a></h5><blockquote>
<p><code>rpoplpush</code>    source   destination(newList)  // 先移除source最后的元素，再将该元素添加到newList中</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130703.png" alt></p>
<h4><span id="shi-yong-chang-jing">使用场景：</span><a href="#shi-yong-chang-jing" class="header-anchor">.</a></h4><ol>
<li>栈（lpush、lpop）</li>
<li>队列（lpush、rpop）<ol>
<li>消息队列</li>
</ol>
</li>
<li>阻塞队列</li>
</ol>
<h3><span id="set-ji-he">Set（集合）</span><a href="#set-ji-he" class="header-anchor">.</a></h3><blockquote>
<p>集合中的值不能重复（无序）</p>
</blockquote>
<h4><span id="1-tian-jia-cheng-yuan-dao-ji-he-zhong-bing-cha-kan-suo-you-cheng-yuan">1.添加成员到集合中，并查看所有成员</span><a href="#1-tian-jia-cheng-yuan-dao-ji-he-zhong-bing-cha-kan-suo-you-cheng-yuan" class="header-anchor">.</a></h4><blockquote>
<p><code>sadd</code>    key     member</p>
</blockquote>
<blockquote>
<p><code>smembers</code>   key</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130707.png" alt></p>
<h4><span id="2-pan-ding-cheng-yuan-shi-fou-cun-zai">2.判定成员是否存在</span><a href="#2-pan-ding-cheng-yuan-shi-fou-cun-zai" class="header-anchor">.</a></h4><blockquote>
<p><code>sismember</code>   key    member</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130711.png" alt></p>
<h4><span id="3-cha-kan-ji-he-chang-du-te-bie">3.查看集合长度（特别）</span><a href="#3-cha-kan-ji-he-chang-du-te-bie" class="header-anchor">.</a></h4><blockquote>
<p><code>scard</code>   key</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130716.png" alt></p>
<h4><span id="4-yi-chu-zhi-ding-de-cheng-yuan">4.移除指定的成员</span><a href="#4-yi-chu-zhi-ding-de-cheng-yuan" class="header-anchor">.</a></h4><blockquote>
<p><code>srem</code>   key    member</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130719.png" alt></p>
<h4><span id="5-huo-qu-ji-he-zhong-de-sui-ji-cheng-yuan">5.获取集合中的随机成员</span><a href="#5-huo-qu-ji-he-zhong-de-sui-ji-cheng-yuan" class="header-anchor">.</a></h4><blockquote>
<p><code>srandmember</code>    key   [count]</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130722.png" alt></p>
<h4><span id="6-sui-ji-yi-chu-cheng-yuan">6.随机移除成员</span><a href="#6-sui-ji-yi-chu-cheng-yuan" class="header-anchor">.</a></h4><blockquote>
<p><code>spop</code>    key   [count]</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130726.png" alt></p>
<h4><span id="7-yi-dong-ji-he-cheng-yuan-dao-qi-ta-ji-he">7.移动集合成员到其他集合</span><a href="#7-yi-dong-ji-he-cheng-yuan-dao-qi-ta-ji-he" class="header-anchor">.</a></h4><blockquote>
<p><code>smove</code>   source    destination   member(需要移动的成员)</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130730.png" alt></p>
<h4><span id="8-shu-zi-ji-he-lei">8.数字集合类：</span><a href="#8-shu-zi-ji-he-lei" class="header-anchor">.</a></h4><ul>
<li>差集 <code>sdiff</code>   key1 ，key2 …</li>
<li>交集（共同好友）<code>sinter</code>   key1，key2 …</li>
<li>并集 <code>sunion</code>   key1 ，key2 …</li>
</ul>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130734.png" alt></p>
<h3><span id="hash-ha-xi">Hash（哈希）</span><a href="#hash-ha-xi" class="header-anchor">.</a></h3><blockquote>
<p>key-Map  or  key-&lt;k,v&gt;，value是一个Map</p>
</blockquote>
<blockquote>
<p>Hash本质和hash没有区别，只是value变成了Map</p>
</blockquote>
<blockquote>
<p>用户信息保存，经常变动的信息，适合对象的存储</p>
</blockquote>
<h4><span id="1-jian-dan-cun-chu-map-he-huo-qu-map">1.简单存储Map和获取Map</span><a href="#1-jian-dan-cun-chu-map-he-huo-qu-map" class="header-anchor">.</a></h4><blockquote>
<p><code>hset</code>   key    field   value  [k1  v1  [k2  v2  …]]</p>
</blockquote>
<blockquote>
<p><code>hget</code>    key   field</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130741.png" alt></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130745.png" alt></p>
<h4><span id="2-huo-qu-suo-you-map-zi-duan-ji-zhi">2.获取所有Map字段及值</span><a href="#2-huo-qu-suo-you-map-zi-duan-ji-zhi" class="header-anchor">.</a></h4><blockquote>
<p><code>hgetall</code>   key</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130748.png" alt></p>
<h4><span id="3-shan-chu-map-zhong-de-zi-duan">3.删除Map中的字段</span><a href="#3-shan-chu-map-zhong-de-zi-duan" class="header-anchor">.</a></h4><blockquote>
<p><code>hdel</code>    key    field</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130753.png" alt></p>
<h4><span id="4-cha-kan-map-zhong-mou-zi-duan-shi-fou-cun-zai">4.查看Map中某字段是否存在</span><a href="#4-cha-kan-map-zhong-mou-zi-duan-shi-fou-cun-zai" class="header-anchor">.</a></h4><blockquote>
<p><code>hexists</code>    key    field</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130758.png" alt></p>
<h4><span id="5-huo-qu-suo-you-zi-duan-huo-zhe-suo-you-zi-duan-dui-ying-de-zhi">5.获取所有字段或者所有字段对应的值</span><a href="#5-huo-qu-suo-you-zi-duan-huo-zhe-suo-you-zi-duan-dui-ying-de-zhi" class="header-anchor">.</a></h4><blockquote>
<p><code>hkeys</code>    key    // 此处的key是Map名</p>
</blockquote>
<blockquote>
<p><code>hvals</code>    key    </p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130801.png" alt></p>
<h4><span id="6-zeng-liang-i">6.增量i++</span><a href="#6-zeng-liang-i" class="header-anchor">.</a></h4><blockquote>
<p><code>hincrby</code>   key   field    value</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130805.png" alt></p>
<h4><span id="7-bu-cun-zai-jiu-tian-jia-cheng-gong">7.不存在，就添加成功</span><a href="#7-bu-cun-zai-jiu-tian-jia-cheng-gong" class="header-anchor">.</a></h4><blockquote>
<p><code>hsetnx</code>    key    field    value  // field 在map中不存在就添加这个值，否则不做改变</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130808.png" alt></p>
<h4><span id="8-gua-he-cun-chu-dui-xiang">8.适合存储对象</span><a href="#8-gua-he-cun-chu-dui-xiang" class="header-anchor">.</a></h4><p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130813.png" alt></p>
<h3><span id="zset-you-xu-ji-he">Zset（有序集合）</span><a href="#zset-you-xu-ji-he" class="header-anchor">.</a></h3><blockquote>
<p>在Set基础上增加了一个值（用于排序的值）</p>
</blockquote>
<blockquote>
<p>存储班级成绩表，工资表排序，</p>
<p>普通消息 = 1，重要消息 = 2，带权重进行判断</p>
<p>排行榜应用实现</p>
</blockquote>
<h4><span id="1-tian-jia-he-huo-qu">1.添加 和 获取</span><a href="#1-tian-jia-he-huo-qu" class="header-anchor">.</a></h4><blockquote>
<p><code>zadd</code>    key     n    value</p>
</blockquote>
<blockquote>
<p><code>zrange</code>   key    startIndex    endIndex</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130816.png" alt></p>
<h4><span id="2-pai-xu-shi-xian-sheng-xu-he-jiang-xu">2.排序实现（升序和降序）</span><a href="#2-pai-xu-shi-xian-sheng-xu-he-jiang-xu" class="header-anchor">.</a></h4><blockquote>
<p><code>zrangebyscore</code>     key      -inf      +inf      [withscores]  // 升序</p>
<p><code>zrange</code>     key    0      -1</p>
</blockquote>
<blockquote>
<p><code>zrevrangebyscore</code>    key     +inf     -inf       [withscores]  // 降序</p>
<p><code>zrevrange</code>    key   0    -1</p>
</blockquote>
<blockquote>
<p><code>zrangebyscore</code>    key    -inf    任意值n  // 升序 + 显示区间  [-inf，n]</p>
</blockquote>
<h4><span id="3-yi-chu-zhi-ding-de-zhi">3.移除指定的值</span><a href="#3-yi-chu-zhi-ding-de-zhi" class="header-anchor">.</a></h4><blockquote>
<p><code>zrem</code>    key    value</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130821.png" alt></p>
<h4><span id="4-ji-he-de-chang-du">4.集合的长度</span><a href="#4-ji-he-de-chang-du" class="header-anchor">.</a></h4><blockquote>
<p><code>zcard</code>    key </p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130826.png" alt></p>
<h4><span id="5-zhi-ding-qu-jian-de-ji-he-chang-du">5.指定区间的集合长度</span><a href="#5-zhi-ding-qu-jian-de-ji-he-chang-du" class="header-anchor">.</a></h4><blockquote>
<p><code>zcount</code>    key     startIndex    endIndex</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130829.png" alt></p>
<h2><span id="si-san-chong-te-shu-shu-ju-lei-xing">四、三种特殊数据类型</span><a href="#si-san-chong-te-shu-shu-ju-lei-xing" class="header-anchor">.</a></h2><h3><span id="geospatial">Geospatial</span><a href="#geospatial" class="header-anchor">.</a></h3><blockquote>
<p>朋友的定位，附近的人，打车距离计算</p>
<p>底层是 <code>Zset</code>，<strong>即可以使用Zset的命令操作Geospatial</strong></p>
</blockquote>
<p><code>Redis3.2就支持了</code></p>
<h4><span id="1-tian-jia-di-li-wei-zhi">1.添加地理位置</span><a href="#1-tian-jia-di-li-wei-zhi" class="header-anchor">.</a></h4><ul>
<li>两极无法添加</li>
<li>经度：-180 ~ 180（度）</li>
<li>纬度：-85.05112878 ~ 85.05112878（度）</li>
</ul>
<blockquote>
<p><code>geoadd</code>     key    经度    纬度     名称</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130835.png" alt></p>
<h4><span id="2-huo-qu-zhi-ding-wei-zhi-de-di-li-wei-zhi">2.获取指定位置的地理位置</span><a href="#2-huo-qu-zhi-ding-wei-zhi-de-di-li-wei-zhi" class="header-anchor">.</a></h4><blockquote>
<p><code>geopos</code>     key     名称</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130839.png" alt></p>
<h4><span id="3-fan-hui-liang-ge-gei-ding-wei-zhi-zhi-jian-de-ju-chi-zhi-xian-ju-chi">3.返回两个给定位置之间的距离（直线距离）</span><a href="#3-fan-hui-liang-ge-gei-ding-wei-zhi-zhi-jian-de-ju-chi-zhi-xian-ju-chi" class="header-anchor">.</a></h4><ul>
<li>单位：<ul>
<li>m ：米</li>
<li>km ：千米</li>
<li>mi ： 英里</li>
<li>ft ：英尺</li>
</ul>
</li>
</ul>
<blockquote>
<p><code>geodist</code>    key     </p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130844.png" alt></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130848.png" alt></p>
<h4><span id="4-yi-gei-ding-zhi-wei-ban-jing-yi-jing-du-he-wei-du-wei-zhong-xin-cha-zhao">4.以给定值为半径，以经度和维度为中心，查找</span><a href="#4-yi-gei-ding-zhi-wei-ban-jing-yi-jing-du-he-wei-du-wei-zhong-xin-cha-zhao" class="header-anchor">.</a></h4><ul>
<li>附近的人（获得所有附近的人的地址（开启定位））通过半径查询</li>
</ul>
<blockquote>
<p><code>georadius</code>     key     经度       纬度         半径         单位</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130852.png" alt></p>
<h4><span id="5-yi-gei-ding-zhi-wei-ban-jing-yi-cheng-yuan-cheng-shi-ming-wei-zhong-xin-cha-zhao">5.以给定值为半径，以成员(城市名)为中心，查找</span><a href="#5-yi-gei-ding-zhi-wei-ban-jing-yi-cheng-yuan-cheng-shi-ming-wei-zhong-xin-cha-zhao" class="header-anchor">.</a></h4><blockquote>
<p><code>georadiusbymember</code>     key     成员名       半径         单位</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130856.png" alt></p>
<h4><span id="6-fan-hui-yi-ge-huo-duo-ge-wei-zhi-yuan-su-de-geohash-biao-shi">6.返回一个或多个位置元素的geohash表示</span><a href="#6-fan-hui-yi-ge-huo-duo-ge-wei-zhi-yuan-su-de-geohash-biao-shi" class="header-anchor">.</a></h4><ul>
<li>如果两个字符串越相似，表示两个地方越近</li>
</ul>
<blockquote>
<p><code>geohash</code>      key       成员1       成员2</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130900.png" alt></p>
<h3><span id="hyperloglog">Hyperloglog</span><a href="#hyperloglog" class="header-anchor">.</a></h3><blockquote>
<p>基数统计的算法</p>
</blockquote>
<ul>
<li>优点<ul>
<li>占用内存是<strong>固定的</strong>，2<sup>64</sup>不同的元素的基数，只需要12KB的内存。（大数据情况下，有0.81%错误率）</li>
</ul>
</li>
</ul>
<blockquote>
<p>基数：集合中元素的个数（先去重），如{1,2,2,3}  其基数为3（集合去重后为1,2,3 有3个元素）</p>
</blockquote>
<blockquote>
<p>网页的UV（一个人访问访问一个网站多次，但是还是算作一个人）</p>
</blockquote>
<p>传统实现UV：Set保存用户的Id，然后统计set中的元素的数量作为标准判断（这种需要保存大量用户的ID）</p>
<p><code>Redis2.8.9</code></p>
<h5><span id="1-ce-shi">1.测试</span><a href="#1-ce-shi" class="header-anchor">.</a></h5><blockquote>
<p>创建一组元素  ： <code>pfadd</code>    key     ele1  ele2  ele3   …</p>
</blockquote>
<blockquote>
<p>统计对应key的基数：<code>pfcount</code>     key1    [key2  …]    // 多个key 就是统计这些key并集的基数</p>
</blockquote>
<blockquote>
<p>合并：<code>pfmerge</code>      destkey      sourceKey1      sourceKey2     [sourceKey3 …] </p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130905.png" alt="image-20201115213230322"></p>
<h3><span id="bitmaps">Bitmaps</span><a href="#bitmaps" class="header-anchor">.</a></h3><blockquote>
<p>位存储，位图（操作二进制）</p>
</blockquote>
<p>统计用户信息，活跃，不活跃！登录、未登录！打卡，365打卡！(两个状态都可以使用)</p>
<h4><span id="1-an-li-yi-zhou-da-qia-ji-lu">1.案例：一周打卡记录</span><a href="#1-an-li-yi-zhou-da-qia-ji-lu" class="header-anchor">.</a></h4><p><strong>一周过去</strong></p>
<blockquote>
<p><code>setbit</code>    key    offset     bit</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130909.png" alt></p>
<p><strong>查看单天打卡情况</strong></p>
<blockquote>
<p><code>getbit</code>    key    offset </p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130914.png" alt></p>
<p><strong>统计所有打卡的天数</strong></p>
<blockquote>
<p><code>bitcount</code>    key</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130919.png" alt></p>
<h2><span id="wu-shi-wu">五、事务</span><a href="#wu-shi-wu" class="header-anchor">.</a></h2><blockquote>
<p>注意：Redis单条命令是保证原子性的；<mark><strong>但是事务不保证原子性！</strong></mark></p>
<p><mark><strong>Redis事务没有隔离级别的概念</strong>，所有的命令在事务中，并没有直接被执行，只有发起执行命令时才执行</mark></p>
</blockquote>
<p><strong>Redis事务本质：</strong>一组命令的集合，一个事务中的所有命令都会别序列化，在事务执行过程中，会按照顺序执行！</p>
<pre class="line-numbers language-bahs"><code class="language-bahs">--- 队列 set set set 执行 ---<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>一次性、顺序性、排他性！执行一些列的命令</p>
<p><strong>Redis的事务：</strong></p>
<ul>
<li>开启事务（<code>multi</code>）</li>
<li>命令入队（<code>其他命令</code>）</li>
<li>执行事务（<code>exec</code>）</li>
</ul>
<blockquote>
<h3><span id="zheng-chang-shi-wu-de-zhi-xing">正常事务的执行</span><a href="#zheng-chang-shi-wu-de-zhi-xing" class="header-anchor">.</a></h3></blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130924.png" alt></p>
<blockquote>
<h3><span id="qu-xiao-shi-wu">取消事务</span><a href="#qu-xiao-shi-wu" class="header-anchor">.</a></h3></blockquote>
<p><code>discard</code></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130927.png" alt="、"></p>
<blockquote>
<h3><span id="yi-chang-zhi-xing">异常执行</span><a href="#yi-chang-zhi-xing" class="header-anchor">.</a></h3></blockquote>
<h4><span id="1-bian-yi-shi-ming-ling-xie-cuo">1.编译时（命令写错）</span><a href="#1-bian-yi-shi-ming-ling-xie-cuo" class="header-anchor">.</a></h4><blockquote>
<p><strong>整个命令队列都不会执行</strong></p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130931.png" alt></p>
<h4><span id="2-yun-xing-shi">2.运行时</span><a href="#2-yun-xing-shi" class="header-anchor">.</a></h4><blockquote>
<p><strong>报错语句，会抛出异常；其他语句照样运行</strong></p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130935.png" alt></p>
<h3><span id="jian-kong-watch-mian-shi-chang-wen">监控 Watch（面试常问）</span><a href="#jian-kong-watch-mian-shi-chang-wen" class="header-anchor">.</a></h3><h4><span id="le-guan-suo-shi-xian-miao-sha">乐观锁：实现秒杀</span><a href="#le-guan-suo-shi-xian-miao-sha" class="header-anchor">.</a></h4><ul>
<li>顾名思义，很乐观，认为什么时候都不会出现问题，所以不会加锁！（更新数据的时候去判断一下，在此期间是否有人修改过这个数据）<ul>
<li>获取version</li>
<li>更新的时候比较version</li>
</ul>
</li>
</ul>
<h4><span id="bei-guan-suo">悲观锁</span><a href="#bei-guan-suo" class="header-anchor">.</a></h4><ul>
<li>顾名思义，很悲观，认为什么时候都会出现问题，无论做什么都会加锁！</li>
</ul>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130942.png" alt></p>
<h4><span id="redis-shi-xian-le-guan-suo">Redis实现乐观锁</span><a href="#redis-shi-xian-le-guan-suo" class="header-anchor">.</a></h4><h5><span id="zhi-xing-cheng-gong-dan-xian-cheng-mei-you-gan-rao-qing-kuang">执行成功（单线程没有干扰情况）</span><a href="#zhi-xing-cheng-gong-dan-xian-cheng-mei-you-gan-rao-qing-kuang" class="header-anchor">.</a></h5><p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130946.png" alt></p>
<h5><span id="ce-shi-duo-xian-cheng-xiu-gai-zhi-shi-yong-watch-ke-yi-dang-zuo-redis-de-le-guan-suo-cao-zuo">测试多线程修改值，使用watch可以当作redis的<mark>乐观锁操作</mark></span><a href="#ce-shi-duo-xian-cheng-xiu-gai-zhi-shi-yong-watch-ke-yi-dang-zuo-redis-de-le-guan-suo-cao-zuo" class="header-anchor">.</a></h5><p><strong>演示</strong>‘</p>
<p>①开启俩个，客户端，模拟多线程情况</p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119130959.png" alt="image-20201116083639168"></p>
<p>②左边支出20元（但是不执行事务），然后右边修改money的数值</p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131006.png" alt></p>
<p>③左边执行事务，发现执行操作返回nil，查看money和out，发现事务并没有被执行（确实有乐观锁的效果）</p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131010.png" alt></p>
<p><strong>如果修改失败获取最新的值就好（<mark><code>exec</code>、<code>unwatch</code>、``discard`都可以清除连接时所有的监视）</mark></strong></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131014.png" alt></p>
<h5><span id="xiao-jie">小结</span><a href="#xiao-jie" class="header-anchor">.</a></h5><ul>
<li>使用Redis实现乐观锁（watch监听某一个key，获取其最新的value）<ul>
<li>在提交事务时，如果key的value没有发生变化，则成功执行</li>
<li>在提交事务时，如果key的value发生了变化，则无法成功执行</li>
</ul>
</li>
</ul>
<h2><span id="liu-jedis">六、Jedis</span><a href="#liu-jedis" class="header-anchor">.</a></h2><h3><span id="1-shi-me-shi-jedis">1、什么是Jedis</span><a href="#1-shi-me-shi-jedis" class="header-anchor">.</a></h3><blockquote>
<p>Jedis是一个用java写的Redis数据库操作的客户端，通过Jedis，可以很方便的对redis数据库进行操作</p>
</blockquote>
<h3><span id="2-shi-yong">2、使用</span><a href="#2-shi-yong" class="header-anchor">.</a></h3><p>①新建空maven项目</p>
<p>②导入依赖</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--导入jedis包 Redis客户端--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span class="token comment" spellcheck="true">&lt;!--导入fastjson--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>fastjson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.2.70<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>③编码</p>
<blockquote>
<p>下面使用远程连接需要的操作：<a href="https://blog.csdn.net/weixin_43423864/article/details/109087670" target="_blank" rel="noopener">https://blog.csdn.net/weixin_43423864/article/details/109087670</a></p>
</blockquote>
<ol>
<li><strong>连接数据库</strong></li>
</ol>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PingTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 1. new Jedis 对象</span>
        Jedis jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"ip地址"</span><span class="token punctuation">,</span><span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 如果设置密码 需要认证，没有设置忽略下面这条语句</span>
        jedis<span class="token punctuation">.</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token string">"密码"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">/// jedis 所有的命令(方法)都是之前学的命令</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 测试连接</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131021.png" alt></p>
<ol start="2">
<li><p><strong>操作</strong></p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 连通</span>
Jedis jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"ip地址"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jedis<span class="token punctuation">.</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token string">"密码"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//基本操作</span>
System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"清空数据："</span> <span class="token operator">+</span> jedis<span class="token punctuation">.</span><span class="token function">flushAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"判断key（name）是否存在："</span> <span class="token operator">+</span> jedis<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"设置name的value："</span> <span class="token operator">+</span> jedis<span class="token punctuation">.</span><span class="token function">setnx</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"liuyou"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"设置pwd的value："</span> <span class="token operator">+</span> jedis<span class="token punctuation">.</span><span class="token function">setnx</span><span class="token punctuation">(</span><span class="token string">"pwd"</span><span class="token punctuation">,</span> <span class="token string">"密码"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"打印所有的key："</span> <span class="token operator">+</span> jedis<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"获取该name的value："</span> <span class="token operator">+</span> jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"删除pwd："</span> <span class="token operator">+</span> jedis<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token string">"pwd"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"重命名name为username："</span> <span class="token operator">+</span> jedis<span class="token punctuation">.</span><span class="token function">rename</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"打印所有的key："</span> <span class="token operator">+</span> jedis<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"返回当前数据库中key的数目："</span> <span class="token operator">+</span> jedis<span class="token punctuation">.</span><span class="token function">dbSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-java"><code class="language-java">清空数据：OK
判断key（name）是否存在：<span class="token boolean">false</span>
设置name的value：<span class="token number">1</span>
设置pwd的value：<span class="token number">1</span>
打印所有的key：<span class="token punctuation">[</span>pwd<span class="token punctuation">,</span> name<span class="token punctuation">]</span>
获取该name的value：liuyou
删除pwd：<span class="token number">1</span>
重命名name为username：OK
打印所有的key：<span class="token punctuation">[</span>username<span class="token punctuation">]</span>
返回当前数据库中key的数目：<span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><strong>关闭连接</strong></p>
</li>
</ol>
<pre class="line-numbers language-java"><code class="language-java">jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="4">
<li><strong>事务</strong></li>
</ol>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 连通</span>
Jedis jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"IP地址"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jedis<span class="token punctuation">.</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token string">"密码"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

JSONObject jsonObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span><span class="token string">"liuyou"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"pwd"</span><span class="token punctuation">,</span><span class="token string">"密码"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
String s <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

jedis<span class="token punctuation">.</span><span class="token function">flushAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/// 加监听 watch</span>
<span class="token comment" spellcheck="true">// jedis.watch("user");</span>

<span class="token comment" spellcheck="true">// 开启事务</span>
Transaction multi <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">multi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
    multi<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 其他语句</span>

    <span class="token comment" spellcheck="true">// 执行事务</span>
    multi<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 取消事务</span>
    multi<span class="token punctuation">.</span><span class="token function">discard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>

    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 关闭连接</span>
    jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2><span id="qi-springboot-zheng-he">七、SpringBoot整合</span><a href="#qi-springboot-zheng-he" class="header-anchor">.</a></h2><blockquote>
<p>在SpringBoot2.x之后，原来的jedis被替换为lettuce</p>
</blockquote>
<ul>
<li>jedis<ul>
<li>采用的直连，多个线程操作的话，是不安全的，如果想要避免不安全，使用jedis pool连接池！BIO</li>
</ul>
</li>
<li>lettuce<ul>
<li>采用netty，实例可以在多个线程中共享，不存在线程不安全问题，可以减少线程数据了，性能高，NIO</li>
</ul>
</li>
</ul>
<h4><span id="xin-jian-springboot-xiang-mu">①新建springboot项目</span><a href="#xin-jian-springboot-xiang-mu" class="header-anchor">.</a></h4><p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131030.png" alt></p>
<h4><span id="redisautoconfiguration-yuan-ma-fen-xi">② <code>RedisAutoConfiguration</code>源码分析</span><a href="#redisautoconfiguration-yuan-ma-fen-xi" class="header-anchor">.</a></h4><p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119205923.png" alt></p>
<h4><span id="zheng-he-ce-shi">③整合测试</span><a href="#zheng-he-ce-shi" class="header-anchor">.</a></h4><p>1、导入依赖</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>2、配置Redis（application.xml）</p>
<pre class="line-numbers language-properties"><code class="language-properties"><span class="token comment" spellcheck="true"># SpringBoot 整合Redis</span>
<span class="token attr-name">spring.redis.host</span><span class="token punctuation">=</span><span class="token attr-value">47.110.130.35</span>
<span class="token attr-name">spring.redis.port</span><span class="token punctuation">=</span><span class="token attr-value">6379</span>
<span class="token attr-name">spring.redis.password</span><span class="token punctuation">=</span><span class="token attr-value">liuyou</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>3、编写测试类</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">Redis02SpringbootApplicationTests</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    RedisTemplate redisTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//redisTemplate</span>
        <span class="token comment" spellcheck="true">// 1.使用redisTemplate.opsForxxx 操作对应的数据结构</span>
        <span class="token comment" spellcheck="true">// 2.可使用redisTemplate 进行简单的key操作，如multi、move、watch、keys 等操作</span>
        <span class="token comment" spellcheck="true">/// 3.可使用获取连接，通过连接进行更多操作</span>
           <span class="token comment" spellcheck="true">// RedisConnection connection = redisTemplate.getConnectionFactory().getConnection();</span>
           <span class="token comment" spellcheck="true">// RedisZSetCommands redisZSetCommands = connection.zSetCommands();</span>

        <span class="token comment" spellcheck="true">// 这里只使用1.演示</span>
        ValueOperations str <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        str<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span><span class="token string">"liuminkai刘民锴"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131040.png" alt="结果展示"></p>
<blockquote>
<p>但是存在问题，没有序列化，存储在Redis中的中文会被转义，如下图</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131044.png" alt></p>
<blockquote>
<p>为啥会出现这个情况？ RedisTemplate默认序列化使用JDK的，我们需要使用JSON格式</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131048.png" alt></p>
<blockquote>
<p>如何解决？我们需要编写自定义Redis配置类，自定义RedisTemplate</p>
</blockquote>
<h4><span id="zi-ding-yi-redistemplate">④自定义RedisTemplate</span><a href="#zi-ding-yi-redistemplate" class="header-anchor">.</a></h4><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRedisConfig</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 更改Key ：Object ==> String 符合日常使用</span>
    <span class="token comment" spellcheck="true">// 自己定义了一个 RedisTemplate</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"all"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> RedisTemplate<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span>RedisConnectionFactory factory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 我们为了自己开发方便，一般直接使用 &lt;String, Object></span>
        RedisTemplate<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// Json序列化配置</span>
        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ObjectMapper om <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        om<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span>PropertyAccessor<span class="token punctuation">.</span>ALL<span class="token punctuation">,</span> JsonAutoDetect<span class="token punctuation">.</span>Visibility<span class="token punctuation">.</span>ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        om<span class="token punctuation">.</span><span class="token function">enableDefaultTyping</span><span class="token punctuation">(</span>ObjectMapper<span class="token punctuation">.</span>DefaultTyping<span class="token punctuation">.</span>NON_FINAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jackson2JsonRedisSerializer<span class="token punctuation">.</span><span class="token function">setObjectMapper</span><span class="token punctuation">(</span>om<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// String 的序列化</span>
        StringRedisSerializer stringRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// key采用String的序列化方式</span>
        template<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// hash的key也采用String的序列化方式</span>
        template<span class="token punctuation">.</span><span class="token function">setHashKeySerializer</span><span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// value序列化方式采用jackson</span>
        template<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// hash的value序列化方式采用jackson</span>
        template<span class="token punctuation">.</span><span class="token function">setHashValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> template<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>自定义RedisTemplate后，再启动③的测试类，结果Redis中正常显示</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131054.png" alt></p>
<h4><span id="redisutils-gong-ju-lei">⑤<mark>RedisUtils工具类</mark></span><a href="#redisutils-gong-ju-lei" class="header-anchor">.</a></h4><blockquote>
<p>日常开发我们都不会使用原始的<code>RedisTemplate</code>，都会封装一个RedisUtils工具类便于使用</p>
</blockquote>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>liuyou<span class="token punctuation">.</span>utils<span class="token punctuation">;</span>

<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span>RedisTemplate<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Component<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span>CollectionUtils<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Set<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>TimeUnit<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">RedisUtils</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> RedisTemplate<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> redisTemplate<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// =============================common============================</span>
    <span class="token comment" spellcheck="true">/**
     * 指定缓存失效时间
     * @param key  键
     * @param time 时间(秒)
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">expire</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                redisTemplate<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> time<span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * 根据key 获取过期时间
     * @param key 键 不能为null
     * @return 时间(秒) 返回0代表为永久有效
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getExpire</span><span class="token punctuation">(</span>String key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">getExpire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">/**
     * 判断key是否存在
     * @param key 键
     * @return true 存在 false不存在
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasKey</span><span class="token punctuation">(</span>String key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">hasKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">/**
     * 删除缓存
     * @param key 可以传一个值 或多个
     */</span>
    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">del</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>CollectionUtils<span class="token punctuation">.</span><span class="token function">arrayToList</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">// ============================String=============================</span>

    <span class="token comment" spellcheck="true">/**
     * 普通缓存获取
     * @param key 键
     * @return 值
     */</span>
    <span class="token keyword">public</span> Object <span class="token function">get</span><span class="token punctuation">(</span>String key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> key <span class="token operator">==</span> null <span class="token operator">?</span> null <span class="token operator">:</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * 普通缓存放入
     * @param key   键
     * @param value 值
     * @return true成功 false失败
     */</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">set</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> Object value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">/**
     * 普通缓存放入并设置时间
     * @param key   键
     * @param value 值
     * @param time  时间(秒) time要大于0 如果time小于等于0 将设置无限期
     * @return true成功 false 失败
     */</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">set</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> Object value<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> time<span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">/**
     * 递增
     * @param key   键
     * @param delta 要增加几(大于0)
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">incr</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> <span class="token keyword">long</span> delta<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>delta <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"递增因子必须大于0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> delta<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">/**
     * 递减
     * @param key   键
     * @param delta 要减少几(小于0)
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">decr</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> <span class="token keyword">long</span> delta<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>delta <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"递减因子必须大于0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token operator">-</span>delta<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">// ================================Map=================================</span>

    <span class="token comment" spellcheck="true">/**
     * HashGet
     * @param key  键 不能为null
     * @param item 项 不能为null
     */</span>
    <span class="token keyword">public</span> Object <span class="token function">hget</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> String item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * 获取hashKey对应的所有键值
     * @param key 键
     * @return 对应的多个键值
     */</span>
    <span class="token keyword">public</span> Map<span class="token operator">&lt;</span>Object<span class="token punctuation">,</span> Object<span class="token operator">></span> <span class="token function">hmget</span><span class="token punctuation">(</span>String key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * HashSet
     * @param key 键
     * @param map 对应多个键值
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hmset</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">/**
     * HashSet 并设置时间
     * @param key  键
     * @param map  对应多个键值
     * @param time 时间(秒)
     * @return true成功 false失败
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hmset</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> map<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">/**
     * 向一张hash表中放入数据,如果不存在将创建
     *
     * @param key   键
     * @param item  项
     * @param value 值
     * @return true 成功 false失败
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hset</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> String item<span class="token punctuation">,</span> Object value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> item<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * 向一张hash表中放入数据,如果不存在将创建
     *
     * @param key   键
     * @param item  项
     * @param value 值
     * @param time  时间(秒) 注意:如果已存在的hash表有时间,这里将会替换原有的时间
     * @return true 成功 false失败
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hset</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> String item<span class="token punctuation">,</span> Object value<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> item<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">/**
     * 删除hash表中的值
     *
     * @param key  键 不能为null
     * @param item 项 可以使多个 不能为null
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hdel</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">/**
     * 判断hash表中是否有该项的值
     *
     * @param key  键 不能为null
     * @param item 项 不能为null
     * @return true 存在 false不存在
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hHasKey</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> String item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasKey</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">/**
     * hash递增 如果不存在,就会创建一个 并把新增后的值返回
     *
     * @param key  键
     * @param item 项
     * @param by   要增加几(大于0)
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">hincr</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> String item<span class="token punctuation">,</span> <span class="token keyword">double</span> by<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> item<span class="token punctuation">,</span> by<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">/**
     * hash递减
     *
     * @param key  键
     * @param item 项
     * @param by   要减少记(小于0)
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">hdecr</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> String item<span class="token punctuation">,</span> <span class="token keyword">double</span> by<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> item<span class="token punctuation">,</span> <span class="token operator">-</span>by<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">// ============================set=============================</span>

    <span class="token comment" spellcheck="true">/**
     * 根据key获取Set中的所有值
     * @param key 键
     */</span>
    <span class="token keyword">public</span> Set<span class="token operator">&lt;</span>Object<span class="token operator">></span> <span class="token function">sGet</span><span class="token punctuation">(</span>String key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">members</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> null<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">/**
     * 根据value从一个set中查询,是否存在
     *
     * @param key   键
     * @param value 值
     * @return true 存在 false不存在
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">sHasKey</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> Object value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isMember</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">/**
     * 将数据放入set缓存
     *
     * @param key    键
     * @param values 值 可以是多个
     * @return 成功个数
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">sSet</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">/**
     * 将set数据放入缓存
     *
     * @param key    键
     * @param time   时间(秒)
     * @param values 值 可以是多个
     * @return 成功个数
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">sSetAndTime</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            Long count <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> count<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">/**
     * 获取set缓存的长度
     *
     * @param key 键
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">sGetSetSize</span><span class="token punctuation">(</span>String key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">/**
     * 移除值为value的
     *
     * @param key    键
     * @param values 值 可以是多个
     * @return 移除的个数
     */</span>

    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">setRemove</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            Long count <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> count<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// ===============================list=================================</span>

    <span class="token comment" spellcheck="true">/**
     * 获取list缓存的内容
     *
     * @param key   键
     * @param start 开始
     * @param end   结束 0 到 -1代表所有值
     */</span>
    <span class="token keyword">public</span> List<span class="token operator">&lt;</span>Object<span class="token operator">></span> <span class="token function">lGet</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> <span class="token keyword">long</span> start<span class="token punctuation">,</span> <span class="token keyword">long</span> end<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> null<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">/**
     * 获取list缓存的长度
     *
     * @param key 键
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">lGetListSize</span><span class="token punctuation">(</span>String key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">/**
     * 通过索引 获取list中的值
     *
     * @param key   键
     * @param index 索引 index>=0时， 0 表头，1 第二个元素，依次类推；index&lt;0时，-1，表尾，-2倒数第二个元素，依次类推
     */</span>
    <span class="token keyword">public</span> Object <span class="token function">lGetIndex</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> <span class="token keyword">long</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> null<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">/**
     * 将list放入缓存
     *
     * @param key   键
     * @param value 值
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">lSet</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> Object value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rightPush</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">/**
     * 将list放入缓存
     * @param key   键
     * @param value 值
     * @param time  时间(秒)
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">lSet</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> Object value<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rightPush</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">/**
     * 将list放入缓存
     *
     * @param key   键
     * @param value 值
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">lSet</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>Object<span class="token operator">></span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rightPushAll</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">/**
     * 将list放入缓存
     *
     * @param key   键
     * @param value 值
     * @param time  时间(秒)
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">lSet</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>Object<span class="token operator">></span> value<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rightPushAll</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">/**
     * 根据索引修改list中的某条数据
     *
     * @param key   键
     * @param index 索引
     * @param value 值
     * @return
     */</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">lUpdateIndex</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> <span class="token keyword">long</span> index<span class="token punctuation">,</span> Object value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> index<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">/**
     * 移除N个值为value
     *
     * @param key   键
     * @param count 移除多少个
     * @param value 值
     * @return 移除的个数
     */</span>

    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">lRemove</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> <span class="token keyword">long</span> count<span class="token punctuation">,</span> Object value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            Long remove <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> count<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> remove<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>使用该工具类直接<code>@Autowired</code>注入即可</p>
</blockquote>
<h2><span id="jin-jie">进阶</span><a href="#jin-jie" class="header-anchor">.</a></h2><blockquote>
<p>学会前面的所有内容 ==&gt; Redis基础</p>
</blockquote>
<blockquote>
<p>高级操作都在后面</p>
</blockquote>
<h2><span id="ba-redis-conf-xiang-jie">八、Redis.conf详解</span><a href="#ba-redis-conf-xiang-jie" class="header-anchor">.</a></h2><blockquote>
<p>我们启动Redis，一般都是通过Redis.conf启动（我前面是使用安装服务的6379.conf启动）</p>
<p>因此，我们必须了解Redis.conf的配置，才能更好理解和使用Redis</p>
</blockquote>
<blockquote>
<h3><span id="dan-wei">单位</span><a href="#dan-wei" class="header-anchor">.</a></h3></blockquote>
<ul>
<li><strong>大小写不敏感</strong></li>
</ul>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131119.png" alt></p>
<blockquote>
<h3><span id="bao-han">包含</span><a href="#bao-han" class="header-anchor">.</a></h3></blockquote>
<ul>
<li><p>可以包含多个配置文件（即，这些文件导入到主配置文件 <code>Redis.conf</code> 中）</p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131123.png" alt></p>
</li>
</ul>
<blockquote>
<h3><span id="wang-luo">网络</span><a href="#wang-luo" class="header-anchor">.</a></h3></blockquote>
<pre class="line-numbers language-bash"><code class="language-bash">bind 0.0.0.0 <span class="token comment" spellcheck="true"># IP（默认127.0.0.1）</span>
protected-mode no <span class="token comment" spellcheck="true"># 保护模式（默认yes）</span>
port 6379 <span class="token comment" spellcheck="true"># 端口设置（默认6379）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<h3><span id="tong-yong">通用</span><a href="#tong-yong" class="header-anchor">.</a></h3></blockquote>
<pre class="line-numbers language-bash"><code class="language-bash">daemonize <span class="token function">yes</span> <span class="token comment" spellcheck="true"># 以守护进程方式运行，即后台运行（默认no）</span>

pidfile /var/run/redis_6379.pid <span class="token comment" spellcheck="true"># 如果以后台运行，必须指定一个pid文件</span>

<span class="token comment" spellcheck="true"># 日志</span>
<span class="token comment" spellcheck="true"># Specify the server verbosity level.</span>
<span class="token comment" spellcheck="true"># This can be one of:</span>
<span class="token comment" spellcheck="true"># debug (大量信息, 使用于测试或开发阶段)</span>
<span class="token comment" spellcheck="true"># verbose (许多很少有用的信息，但不像调试级别那样混乱)</span>
<span class="token comment" spellcheck="true"># notice (比较冗长，你可能想在生产环境中使用)</span>
<span class="token comment" spellcheck="true"># warning (只有非常重要/关键的消息被记录下来)</span>
loglevel notice  <span class="token comment" spellcheck="true"># 默认notice</span>
logfile <span class="token string">""</span> <span class="token comment" spellcheck="true"># 日志的文件位置名</span>

databases 16 <span class="token comment" spellcheck="true"># 数据库的数量（默认16）</span>
always-show-logo <span class="token function">yes</span> <span class="token comment" spellcheck="true"># 是否开启 logo （默认yes）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<h3><span id="kuai-zhao">快照</span><a href="#kuai-zhao" class="header-anchor">.</a></h3></blockquote>
<p>持久化，在规定时间内，执行了多少次操作，会被持久化到文件(.rdb，.aof)</p>
<pre class="line-numbers language-bash"><code class="language-bash">save 900 1 <span class="token comment" spellcheck="true"># 900秒内（15分钟），如果至少有1个Key进行修改，我们就进行持久化操作</span>
save 300 10 <span class="token comment" spellcheck="true"># 300秒内（5分钟），如果至少有10个Key进行修改，我们就进行持久化操作</span>
save 60 10000 <span class="token comment" spellcheck="true"># 60秒内（1分钟），如果至少有10000个Key进行修改，我们就进行持久化操作</span>

stop-writes-on-bgsave-error <span class="token function">yes</span> <span class="token comment" spellcheck="true"># 持久化如果出错，是否还需要继续工作（默认yes）</span>

rdbcompression <span class="token function">yes</span> <span class="token comment" spellcheck="true"># 是否压缩rdb文件（默认yes），会消耗一些CPU资源</span>

rdbchecksum <span class="token function">yes</span> <span class="token comment" spellcheck="true"># 保存rdb文件时，进行错误检查检验</span>

<span class="token function">dir</span> ./ <span class="token comment" spellcheck="true"># rdb文件保存的目录</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<h4><span id="zhu-cong-fu-zhi-replication">主从复制 REPLICATION</span><a href="#zhu-cong-fu-zhi-replication" class="header-anchor">.</a></h4></blockquote>
<blockquote>
<h4><span id="an-quan-security">安全 SECURITY</span><a href="#an-quan-security" class="header-anchor">.</a></h4></blockquote>
<pre class="line-numbers language-bash"><code class="language-bash">requirepass 你的密码 <span class="token comment" spellcheck="true"># 设置密码（默认被注释着需要自己解开注释） </span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131144.png" alt></p>
<p><strong>当然可以通过命令行配置(临时，服务重启失效)</strong></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131149.png" alt></p>
<blockquote>
<h4><span id="ke-hu-duan-xian-zhi">客户端限制</span><a href="#ke-hu-duan-xian-zhi" class="header-anchor">.</a></h4></blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># maxclients 10000 # 限制最多10000个客户端访问（默认注释）</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<h4><span id="nei-cun-guan-li">内存管理</span><a href="#nei-cun-guan-li" class="header-anchor">.</a></h4></blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># maxmemory &lt;bytes> # 最大内存设置（默认注释）</span>

<span class="token comment" spellcheck="true"># maxmemory-policy noeviction # 内存达到上限之后的处理策略（默认noeviction）</span>
    <span class="token comment" spellcheck="true"># 1、volatile-lru：只对设置了过期时间的key进行LRU（默认值） </span>
    <span class="token comment" spellcheck="true"># 2、allkeys-lru ： 删除lru算法的key   </span>
    <span class="token comment" spellcheck="true"># 3、volatile-random：随机删除即将过期key   </span>
    <span class="token comment" spellcheck="true"># 4、allkeys-random：随机删除   </span>
    <span class="token comment" spellcheck="true"># 5、volatile-ttl ： 删除即将过期的   </span>
    <span class="token comment" spellcheck="true"># 6、noeviction ： 永不过期，返回错误</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<h3><span id="append-only-mode-aof-pei-zhi">APPEND ONLY MODE (AOF配置)</span><a href="#append-only-mode-aof-pei-zhi" class="header-anchor">.</a></h3></blockquote>
<pre class="line-numbers language-bash"><code class="language-bash">appendonly no <span class="token comment" spellcheck="true"># 默认是不开启aof的，默认使用rdb方式持久化</span>
appendfilename <span class="token string">"appendonly.aof"</span> <span class="token comment" spellcheck="true"># 持久化的文件名</span>

<span class="token comment" spellcheck="true"># appendfsync always # 每次修改都会同步，销耗性能</span>
appendfsync everysec <span class="token comment" spellcheck="true"># 每秒执行一次同步，可能会丢失这1秒的数据</span>
<span class="token comment" spellcheck="true"># appendfsync no # 不同步，操作系统自己同步数据，速度最快</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2><span id="jiu-redis-chi-jiu-hua-chong-dian">九、Redis持久化（重点）</span><a href="#jiu-redis-chi-jiu-hua-chong-dian" class="header-anchor">.</a></h2><blockquote>
<p>Redis是内存数据库，数据库状态断电及失，因此Redis提供了持久化功能（内存数据写入磁盘）</p>
</blockquote>
<h3><span id="1-rdb-redis-database">1、RDB（Redis DataBase）</span><a href="#1-rdb-redis-database" class="header-anchor">.</a></h3><blockquote>
<p>RDB持久化是指在指定的时间间隔内将内存中的数据集快照写入磁盘，实际操作过程是fork一个子进程，先将数据集写入临时文件，写入成功后，再替换之前的文件，用二进制压缩存储。 保存文件格式 <code>dump.rdb</code></p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131158.png" alt></p>
<p><img src="/2020/11/02/9349/image-20201117102650803.png" alt></p>
<h4><span id="she-zhi-rdb-wen-jian-bao-cun-tiao-jian">设置RDB文件保存条件</span><a href="#she-zhi-rdb-wen-jian-bao-cun-tiao-jian" class="header-anchor">.</a></h4><p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131204.png" alt></p>
<p><strong>重启服务</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash">systemctl restart redis_6379<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h5><span id="jie-guo-ce-shi">结果测试</span><a href="#jie-guo-ce-shi" class="header-anchor">.</a></h5><p><strong>1.查看rdb文件存放的目录</strong></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131209.png" alt></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131213.png" alt></p>
<p><strong>2.删除已有的dump.rdb文件</strong></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131218.png" alt></p>
<p><strong>3.添加5个key</strong></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131223.png" alt></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131228.png" alt="发现重新生成rdb文件"></p>
<h4><span id="rdb-wen-jian-sheng-cheng-hong-fa-ji-zhi"><strong>RDB文件生成触发机制</strong></span><a href="#rdb-wen-jian-sheng-cheng-hong-fa-ji-zhi" class="header-anchor">.</a></h4><p>1.满足redis.conf中，快照save生成条件</p>
<p>2.使用flushall命令，自动生成一个RDB文件</p>
<p>3.退出redis</p>
<h4><span id="rdb-wen-jian-hui-fu">RDB文件恢复</span><a href="#rdb-wen-jian-hui-fu" class="header-anchor">.</a></h4><blockquote>
<p>只需要将RDB文件放入Redis启动目录就可以了，Redis自动加载</p>
</blockquote>
<h4><span id="you-que-dian">优缺点</span><a href="#you-que-dian" class="header-anchor">.</a></h4><ul>
<li>优点：<ul>
<li>适合大规模的数据恢复！</li>
<li>对数据完整性要求不高</li>
</ul>
</li>
<li>缺点：<ul>
<li>需要一定的时间间隔进程操作；如果redis意外宕机，最后一次修改数据就没有了</li>
<li>fork进程的时候，会占用一定的空间</li>
</ul>
</li>
</ul>
<h3><span id="2-aof-append-only-file">2、AOF（Append Only File）</span><a href="#2-aof-append-only-file" class="header-anchor">.</a></h3><blockquote>
<p>AOF持久化以<strong>日志</strong>的形式<strong>记录服务器所处理的每一个写、删除操作</strong>，<strong>查询操作不会记录</strong>，<mark>只许追加文件，不许改写文件</mark>。以文本的方式记录，可以打开文件看到详细的操作记录。</p>
<p> 保存文件格式 <code>appendonly.aof</code></p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131235.png" alt></p>
<p><strong>aof默认不开启，需要到配置文件中开启</strong></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131240.png" alt></p>
<h5><span id="chong-qi-redis-hou-appendonly-aof-wen-jian-zi-dong-sheng-cheng">重启redis后，appendonly.aof文件自动生成</span><a href="#chong-qi-redis-hou-appendonly-aof-wen-jian-zi-dong-sheng-cheng" class="header-anchor">.</a></h5><p><strong>客户端进行一些操作</strong></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131247.png" alt></p>
<p><strong>appendonly.aof文件内容，日志形式记录</strong></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131252.png" alt></p>
<h5><span id="chong-xie-gui-zhi">重写规制</span><a href="#chong-xie-gui-zhi" class="header-anchor">.</a></h5><blockquote>
<p>如果aof文件大于64mb，就会fork一个新进程来将我们的文件进行重写（清除之前的64mb）</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131257.png" alt></p>
<h5><span id="cuo-wu-xiu-fu">错误修复</span><a href="#cuo-wu-xiu-fu" class="header-anchor">.</a></h5><p>如果aof文件有错误，redis是启动不了的，可以使用官方自带 <code>redis-check-aof --fix aof文件</code>进行修复</p>
<h5><span id="you-que-dian">优缺点</span><a href="#you-que-dian" class="header-anchor">.</a></h5><ul>
<li>优点<ul>
<li>每一次修改都同步，文件完整性会更好</li>
<li>每秒同步一次，可能会丢失一秒数据</li>
</ul>
</li>
<li>缺点<ul>
<li>相对于数据文件来说，aof远远大于rdb，修复速度比rdb慢</li>
<li>aof运行速率比rdb慢（追加，频繁IO操作）</li>
</ul>
</li>
</ul>
<h3><span id="kuo-zhan">扩展</span><a href="#kuo-zhan" class="header-anchor">.</a></h3><p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131303.png" alt></p>
<h2><span id="shi-redis-fa-bu-ding-yue">十、Redis发布订阅</span><a href="#shi-redis-fa-bu-ding-yue" class="header-anchor">.</a></h2><p>Redis 发布订阅(pub/sub)是一种<strong>消息通信模式</strong>：发送者(pub)发送消息，订阅者(sub)接收消息。微信、微博、关注系统！</p>
<p>Redis客户端可以订阅任意数量的频道</p>
<p><strong>订阅/发布消息图：</strong></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131309.png" alt="订阅/发布消息图"></p>
<p>下图展示了频道 channel1 ， 以及订阅这个频道的三个客户端 —— client2 、 client5 和 client1 之间的关系：</p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131317.png" alt></p>
<p>当有新消息通过 PUBLISH 命令发送给频道 channel1 时， 这个消息就会被发送给订阅它的三个客户端：</p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131322.png" alt></p>
<h3><span id="ming-ling">命令</span><a href="#ming-ling" class="header-anchor">.</a></h3><p>这些命令被广泛用于构建即时通信应用，比如网络聊天室（chatroom）和实时广播、实时提醒等。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>PSUBSCRIBE pattern [pattern..]</code></td>
<td>订阅一个或多个符合给定模式的频道。</td>
</tr>
<tr>
<td><code>PUNSUBSCRIBE pattern [pattern..]</code></td>
<td>退订一个或多个符合给定模式的频道。</td>
</tr>
<tr>
<td><code>PUBSUB subcommand [argument[argument]]</code></td>
<td>查看订阅与发布系统状态。</td>
</tr>
<tr>
<td><code>PUBLISH channel message</code></td>
<td>向指定频道发布消息</td>
</tr>
<tr>
<td><code>SUBSCRIBE channel [channel..]</code></td>
<td>订阅给定的一个或多个频道。</td>
</tr>
<tr>
<td><code>SUBSCRIBE channel [channel..]</code></td>
<td>退订一个或多个频道</td>
</tr>
</tbody></table>
<h3><span id="ce-shi">测试</span><a href="#ce-shi" class="header-anchor">.</a></h3><p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131328.png" alt></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131335.png" alt></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131340.png" alt></p>
<pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> subscribe blog <span class="token comment" spellcheck="true"># 订阅频道</span>
Reading messages<span class="token punctuation">..</span>. <span class="token punctuation">(</span>press Ctrl-C to quit<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 等待推送信息</span>
1<span class="token punctuation">)</span> <span class="token string">"subscribe"</span>
2<span class="token punctuation">)</span> <span class="token string">"blog"</span>
3<span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
1<span class="token punctuation">)</span> <span class="token string">"message"</span> <span class="token comment" spellcheck="true"># 消息</span>
2<span class="token punctuation">)</span> <span class="token string">"blog"</span> <span class="token comment" spellcheck="true"># 消息来自频道</span>
3<span class="token punctuation">)</span> <span class="token string">"hello world!"</span> <span class="token comment" spellcheck="true"># 消息内容</span>


127.0.0.1:6379<span class="token operator">></span> publish blog <span class="token string">"hello world!"</span> <span class="token comment" spellcheck="true"># 发送消息到频道</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3><span id="yuan-li">原理</span><a href="#yuan-li" class="header-anchor">.</a></h3><p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131347.png" alt></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131412.png" alt></p>
<p>每个 Redis 服务器进程都维持着一个表示服务器状态的 redis.h/redisServer 结构， 结构的 pubsub_channels 属性是一个字典， 这个字典就用于保存订阅频道的信息，其中，<strong>字典的键为正在被订阅的频道</strong>， 而<strong>字典的值则是一个链表， 链表中保存了所有订阅这个频道的客户端</strong>。</p>
<p>客户端订阅，就被链接到对应频道的链表的尾部，退订则就是将客户端节点从链表中移除。</p>
<h3><span id="shi-yong-chang-jing">使用场景：</span><a href="#shi-yong-chang-jing" class="header-anchor">.</a></h3><ul>
<li>实时消息系统！</li>
<li>实时聊天！(频道当作聊天室，将信息回显给所有人)</li>
<li>订阅，关注系统都是可以</li>
</ul>
<blockquote>
<p>复杂的情况，使用专业的消息中间件</p>
</blockquote>
<h3><span id="zuo-ding-yue-de-que-dian">做订阅的缺点</span><a href="#zuo-ding-yue-de-que-dian" class="header-anchor">.</a></h3><ol>
<li>如果一个客户端订阅了频道，但自己读取消息的速度却不够快的话，那么不断积压的消息会使redis输出缓冲区的体积变得越来越大，这可能使得redis本身的速度变慢，甚至直接崩溃。</li>
<li>这和数据传输可靠性有关，如果在订阅方断线，那么他将会丢失所有在短线期间发布者发布的消息。</li>
</ol>
<h2><span id="shi-yi-zhu-cong-fu-zhi">十一、主从复制</span><a href="#shi-yi-zhu-cong-fu-zhi" class="header-anchor">.</a></h2><h3><span id="gai-nian">概念</span><a href="#gai-nian" class="header-anchor">.</a></h3><p>主从复制，是指将一台Redis服务器的数据，复制到其他的Redis服务器。前者称为主节点（Master/Leader）,后者称为从节点（Slave/Follower）， 数据的复制是单向的！<strong>只能由主节点复制到从节点</strong>（主节点以写为主、从节点以读为主）。</p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131424.png" alt></p>
<h3><span id="zhu-cong-fu-zhi-de-zhu-yao-zuo-yong">主从复制的主要作用</span><a href="#zhu-cong-fu-zhi-de-zhu-yao-zuo-yong" class="header-anchor">.</a></h3><ol>
<li><strong>数据冗余</strong>：主从复制实现了数据的热备份，是持久化之外的一种数据冗余的方式。</li>
<li><strong>故障恢复</strong>：当主节点故障时，从节点可以暂时替代主节点提供服务，是一种服务冗余的方式</li>
<li><strong>负载均衡</strong>：在主从复制的基础上，配合读写分离，由主节点进行写操作，从节点进行读操作，分担服务器的负载；尤其是在多读少写的场景下，通过多个从节点分担负载，提高并发量。</li>
<li><strong>高可用基石</strong>：主从复制还是哨兵和集群能够实施的基础。</li>
</ol>
<p>一般来说，要将Redis运用与工程项目中，只使用一台Redis是万万不能的（避免宕机，一主二从），原因如下：</p>
<ol>
<li>从结构上，单个Redis服务器会发生单点故障，并且一台服务器需要处理所有的请求负载，压力较大</li>
<li>从容量上，单个Redis服务器内存容量有限，就算一台Redis服务器内存容量为256G，也不能将所有内存用作Redis存储内存，一般来说，<strong>单台服务器最大使用内存不超过20G。</strong></li>
</ol>
<blockquote>
<p>只要在公司中，不可能使用单机（有瓶颈），必须配置集群、使用主从复制</p>
</blockquote>
<h3><span id="huan-jing-pei-zhi">环境配置</span><a href="#huan-jing-pei-zhi" class="header-anchor">.</a></h3><p><mark>只需配置从库，无需配置主库</mark></p>
<p><strong>查看主从复制信息：</strong></p>
<blockquote>
<p>默认情况下，每一个Redis服务器都是主节点</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131432.png" alt></p>
<pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> info replication
<span class="token comment" spellcheck="true"># Replication</span>
role:master  <span class="token comment" spellcheck="true"># 主节点</span>
connected_slaves:0  <span class="token comment" spellcheck="true"># 没有从节点</span>
master_replid:7776dea8df483b02d12cd482d2034ba55ec7dab0
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:0
second_repl_offset:-1
repl_backlog_active:0
repl_backlog_size:1048576
repl_backlog_first_byte_offset:0
repl_backlog_histlen:0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4><span id="1-fu-zhi-pei-zhi-wen-jian-redis-conf-dao-redis-an-zhuang-mu-lu-xia">1、复制配置文件redis.conf到Redis安装目录下</span><a href="#1-fu-zhi-pei-zhi-wen-jian-redis-conf-dao-redis-an-zhuang-mu-lu-xia" class="header-anchor">.</a></h4><p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131438.png" alt></p>
<h4><span id="2-zai-cong-gai-wen-jian-kao-bei-chu-3-ge-wen-jian">2、再从该文件拷贝出3个文件</span><a href="#2-zai-cong-gai-wen-jian-kao-bei-chu-3-ge-wen-jian" class="header-anchor">.</a></h4><p><strong>主：</strong><code>redis_6379.conf</code></p>
<p><strong>从：</strong><code>redis_6380.conf、redis_6381.conf</code></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131447.png" alt></p>
<h4><span id="3-xiu-gai-zhu-pei-zhi-wen-jian">3、修改主配置文件</span><a href="#3-xiu-gai-zhu-pei-zhi-wen-jian" class="header-anchor">.</a></h4><blockquote>
<p>由于端口和后台默认运行pid都是6379的，就不改了</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131452.png" alt="image-20201117125611885"></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131455.png" alt></p>
<h4><span id="4-xiu-gai-cong-pei-zhi-wen-jian">4、修改从配置文件</span><a href="#4-xiu-gai-cong-pei-zhi-wen-jian" class="header-anchor">.</a></h4><blockquote>
<p>下面以  <code>redis_6380.conf</code> 为例， <code>redis_6381.conf</code> 同理</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131500.png" alt></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131504.png" alt></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131508.png" alt></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131512.png" alt></p>
<h4><span id="pei-zhi-wen-jian-xiu-gai-de-xin-xi">配置文件修改的信息</span><a href="#pei-zhi-wen-jian-xiu-gai-de-xin-xi" class="header-anchor">.</a></h4><ol>
<li>端口（92行）</li>
<li>pid进程名（244行）</li>
<li>日志文件名（257行）</li>
<li>rdb文件名（339行）</li>
</ol>
<h4><span id="5-qi-dong-fu-wu-dan-ji-duo-fu-wu">5、启动服务（单机多服务）</span><a href="#5-qi-dong-fu-wu-dan-ji-duo-fu-wu" class="header-anchor">.</a></h4><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">cd</span> /usr/local/bin <span class="token comment" spellcheck="true"># 进入配置文件所在目录</span>


<span class="token punctuation">[</span>root@liuyou bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># redis-server redis_6379.conf</span>
<span class="token punctuation">[</span>root@liuyou bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># redis-server redis_6380.conf</span>
<span class="token punctuation">[</span>root@liuyou bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># redis-server redis_6381.conf</span>
<span class="token punctuation">[</span>root@liuyou bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ps -ef | grep redis  # 查看启动状态</span>
root      2862     1  0 13:13 ?        00:00:00 redis-server 0.0.0.0:6379
root      2868     1  0 13:13 ?        00:00:00 redis-server 0.0.0.0:6380
root      2874     1  0 13:13 ?        00:00:00 redis-server 0.0.0.0:6381
root      2880  2393  0 13:13 pts/0    00:00:00 <span class="token function">grep</span> --color<span class="token operator">=</span>auto redis
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4><span id="6-deng-lu-ke-hu-duan">6、登录客户端</span><a href="#6-deng-lu-ke-hu-duan" class="header-anchor">.</a></h4><p>①开启4个窗口，前三用于主从复制，最后一个用于测试</p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131520.png" alt></p>
<p>②登录（注意端口）</p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131528.png" alt="窗口1"></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131535.png" alt="窗口2"></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131542.png" alt="窗口3"></p>
<h4><span id="7-yi-zhu-er-cong">7、一主二从</span><a href="#7-yi-zhu-er-cong" class="header-anchor">.</a></h4><p><mark>默认情况下，每一个Redis服务器都是主节点</mark></p>
<p><strong>一般情况下，只配置从机</strong></p>
<blockquote>
<p>如果有密码，需要在从配置文件中，进行配置，后面会解释</p>
</blockquote>
<blockquote>
<p>下面以 窗口3（端口为6381） 为例，窗口2同理 </p>
</blockquote>
<h5><span id="shi-yong-slaveof-zhi-ding-zhu-jie-dian-ip-he-duan-kou-lin-shi-pei-zhi"><strong>使用slaveof 指定 主节点 ip 和 端口（临时配置）</strong></span><a href="#shi-yong-slaveof-zhi-ding-zhu-jie-dian-ip-he-duan-kou-lin-shi-pei-zhi" class="header-anchor">.</a></h5><p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131549.png" alt></p>
<p><strong>查看主节点，主从复制信息</strong></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131554.png" alt></p>
<h5><span id="you-mi-ma-pei-zhi-yong-jiu-pei-zhi">有密码配置（+永久配置）</span><a href="#you-mi-ma-pei-zhi-yong-jiu-pei-zhi" class="header-anchor">.</a></h5><p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131609.png" alt></p>
<blockquote>
<p>配置完重启服务</p>
</blockquote>
<h5><span id="ce-shi">测试</span><a href="#ce-shi" class="header-anchor">.</a></h5><blockquote>
<p>Redis只允许，主机写，从机读</p>
</blockquote>
<p><strong>主机写</strong></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131615.png" alt></p>
<p><strong>从机读</strong></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131621.png" alt></p>
<p><strong>从机不能写</strong></p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131626.png" alt></p>
<blockquote>
<p><strong>主机断开连接</strong>，从机依旧连接主机，但是没有写操作，如果从机中途恢复正常，从机依旧可以获取主机写的内容 </p>
</blockquote>
<blockquote>
<p>如果使用命令行配置，从机重启，就会变为主机（只有变为从机，才能获取之前主机内容）</p>
</blockquote>
<blockquote>
<p><strong>从机断开连接</strong>，期间，主机继续写新内容，只要从机恢复，就可获得主机写的新内容</p>
</blockquote>
<h5><span id="fu-zhi-yuan-li">复制原理</span><a href="#fu-zhi-yuan-li" class="header-anchor">.</a></h5><p>Slave 启动成功连接到Master后会发送一个sync命令</p>
<p>Master接收到命令，启动后台的存盘进程，同时收集所有接收到的用于修改数据集命令，在后台进程执行完毕之后，Master将传送整个数据文件到Slave，并完成一次完全同步</p>
<p><strong>全量复制</strong>：而Slave服务在接收到数据库文件数据后，将其存盘并加载到内存中</p>
<p><strong>增量复制</strong>：Master继续将新的所有收集到修改命令依次传给Slave，完成同步</p>
<blockquote>
<p>但是只要重新连接Master，一次完全同步（全量复制）将被自动执行。</p>
</blockquote>
<h4><span id="8-mao-mao-chong-pei-zhi-zhu-cong">8、毛毛虫配置（主从）</span><a href="#8-mao-mao-chong-pei-zhi-zhu-cong" class="header-anchor">.</a></h4><blockquote>
<p>上一个M连接下一个S，（可以看做主从复制的一种实现）</p>
<p>配置只需：将上面配好的，窗口3的主机改为窗口2即可</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131637.png" alt></p>
<h4><span id="9-dang-ji-shou-dong-pei-zhi-zhu-ji">9、宕机手动配置主机</span><a href="#9-dang-ji-shou-dong-pei-zhi-zhu-ji" class="header-anchor">.</a></h4><pre class="line-numbers language-bash"><code class="language-bash">slaveof no one <span class="token comment" spellcheck="true"># 如果主机断开连接，从机可以使用该命令，让自己变为主机，其他节点连到该节点</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p>如果主机如果会来了，也没有从机连接上它。</p>
</blockquote>
<h2><span id="shi-er-shao-bing-mo-shi">十二、哨兵模式</span><a href="#shi-er-shao-bing-mo-shi" class="header-anchor">.</a></h2><blockquote>
<p>自动选举Redis主服务器（如果主服务器宕机）</p>
</blockquote>
<p>在 <code>Redis2.8</code>之前，采用手动配置主机的形式（会导致一段时间服务不可用）</p>
<p><code>Redis2.8</code>之后，Redis正是提供了Sentinel（哨兵）来解决这个问题（<strong>主机宕机，根据投票自动在从机中选出新主机</strong>）</p>
<p><strong>哨兵模式</strong>是一种特殊的模式，首先Redis提供了哨兵的命令，哨兵是一个独立的进程，他会独立运行<strong>。其原理是哨兵通过发送命令，等待Redis服务器响应，从而监控运行的多个Redis实例</strong></p>
<h3><span id="dan-shao-bing-mo-shi">单哨兵模式</span><a href="#dan-shao-bing-mo-shi" class="header-anchor">.</a></h3><p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131646.png" alt="单机哨兵"></p>
<h3><span id="shao-bing-de-zuo-yong">哨兵的作用：</span><a href="#shao-bing-de-zuo-yong" class="header-anchor">.</a></h3><ol>
<li>通过发送命令，让Redis服务器返回监控其运行状态，包括主服务器和从服务器</li>
<li>当哨兵监测到master宕机，会自动将slave切换到master，然后通过 <strong>发布订阅模式</strong> 通知其他的从服务器，修改配置文件，让他们切换主机</li>
</ol>
<h3><span id="duo-shao-bing-mo-shi">多哨兵模式</span><a href="#duo-shao-bing-mo-shi" class="header-anchor">.</a></h3><p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131654.png" alt="多机哨兵"></p>
<p>假设主服务器宕机，哨兵1先检测到这个结果，系统并不会马上进行failover过程，仅仅是哨兵1主观的认为主服务器不可用，这个现象称为<strong>主观下线</strong>。</p>
<p>当其他哨兵也检测到主服务器不可用，并且达到一定数量时，那么哨兵之间就会进行一次投票，投票的结果有一个哨兵发起，进行failover故障转移操作。</p>
<p>切换成功后，就会通过<strong>发布订阅模式</strong>，让各个哨兵把自己监控的从服务器实现切换主机，这个时候称为<strong>客观下线</strong></p>
<h3><span id="ce-shi-yi-zhu-er-cong-dan-shao-bing">测试（一主二从，单哨兵）</span><a href="#ce-shi-yi-zhu-er-cong-dan-shao-bing" class="header-anchor">.</a></h3><h4><span id="1-pei-zhi-shao-bing-pei-zhi-wen-jian-wen-jian-ming-sentinel-conf">1、配置哨兵配置文件（文件名 <code>sentinel.conf</code>）</span><a href="#1-pei-zhi-shao-bing-pei-zhi-wen-jian-wen-jian-ming-sentinel-conf" class="header-anchor">.</a></h4><blockquote>
<p><strong>文件名不能写错</strong>，下面是文件内容（当然这个文件需要自己创建）</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># sentinel monitor 被监控的名称 host port 1       </span>
<span class="token comment" spellcheck="true"># 1 表示 主机宕机，从机投票选举</span>
sentinel monitor myredis  127.0.0.1 6379 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131701.png" alt></p>
<h4><span id="2-qi-dong-shao-bing-mo-shi">2、启动哨兵模式</span><a href="#2-qi-dong-shao-bing-mo-shi" class="header-anchor">.</a></h4><blockquote>
<p>如果被监控有密码 需在 <code>sentinel.conf</code> 配置文件中，追加</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># sentinel auth-pass 被监控主机名称  &lt;password> </span>
sentinel auth-pass myredis  <span class="token operator">&lt;</span>password<span class="token operator">></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash">redis-sentinel sentinel.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131708.png" alt></p>
<h4><span id="3-guan-bi-zhu-ji-ce-shi-xuan-ju-qing-kuang">3、关闭主机，测试选举情况</span><a href="#3-guan-bi-zhu-ji-ce-shi-xuan-ju-qing-kuang" class="header-anchor">.</a></h4><p>①主机关闭</p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131716.png" alt></p>
<p>②哨兵详情</p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131721.png" alt></p>
<p>③检查窗口3（端口为6381）</p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131732.png" alt></p>
<p>④我们恢复窗口1（即之前的主机），看看情况</p>
<blockquote>
<p>变成从机</p>
</blockquote>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131738.png" alt></p>
<h3><span id="you-que-dian">优缺点</span><a href="#you-que-dian" class="header-anchor">.</a></h3><ul>
<li>优点：<ul>
<li>哨兵集群，基于主从复制模式，所有的主从配置优点，它全有</li>
<li>主从可以切换，故障可以转移，系统的可用性就会更好</li>
<li>哨兵模式就是主从模式的升级，手动到自动，更加健壮</li>
</ul>
</li>
<li>缺点<ul>
<li>Redis不好在线扩容的，集群容量一旦达到上线，在线扩容十分麻烦</li>
<li>实现哨兵模式的配置其实是很麻烦的，里面有很多选择</li>
</ul>
</li>
</ul>
<h3><span id="shao-bing-mo-shi-de-quan-bu-pei-zhi">哨兵模式的全部配置</span><a href="#shao-bing-mo-shi-de-quan-bu-pei-zhi" class="header-anchor">.</a></h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># Example sentinel.conf</span>

<span class="token comment" spellcheck="true"># 哨兵sentinel实例运行的端口 默认26379  </span>
<span class="token comment" spellcheck="true"># 如果有哨兵集群 需要配置多个端口</span>
port 26379  

<span class="token comment" spellcheck="true"># 哨兵sentinel的工作目录</span>
<span class="token function">dir</span> /tmp

<span class="token comment" spellcheck="true"># 哨兵sentinel监控的redis主节点的 ip port </span>
<span class="token comment" spellcheck="true"># master-name  可以自己命名的主节点名字 只能由字母A-z、数字0-9 、这三个字符".-_"组成。</span>
<span class="token comment" spellcheck="true"># quorum 当这些quorum个数sentinel哨兵认为master主节点失联 那么这时 客观上认为主节点失联了</span>
<span class="token comment" spellcheck="true"># sentinel monitor &lt;master-name> &lt;ip> &lt;redis-port> &lt;quorum></span>
sentinel monitor mymaster 127.0.0.1 6379 1

<span class="token comment" spellcheck="true"># 当在Redis实例中开启了requirepass foobared 授权密码 这样所有连接Redis实例的客户端都要提供密码</span>
<span class="token comment" spellcheck="true"># 设置哨兵sentinel 连接主从的密码 注意必须为主从设置一样的验证密码</span>
<span class="token comment" spellcheck="true"># sentinel auth-pass &lt;master-name> &lt;password></span>
sentinel auth-pass mymaster MySUPER--secret-0123passw0rd


<span class="token comment" spellcheck="true"># 指定多少毫秒之后 主节点没有应答哨兵sentinel 此时 哨兵主观上认为主节点下线 默认30秒</span>
<span class="token comment" spellcheck="true"># sentinel down-after-milliseconds &lt;master-name> &lt;milliseconds></span>
sentinel down-after-milliseconds mymaster 30000

<span class="token comment" spellcheck="true"># 这个配置项指定了在发生failover主备切换时最多可以有多少个slave同时对新的master进行 同步，</span>
<span class="token comment" spellcheck="true"># 这个数字越小，完成failover所需的时间就越长，</span>
<span class="token comment" spellcheck="true"># 但是如果这个数字越大，就意味着越 多的slave因为replication而不可用。</span>
<span class="token comment" spellcheck="true"># 可以通过将这个值设为 1 来保证每次只有一个slave 处于不能处理命令请求的状态。</span>
<span class="token comment" spellcheck="true"># sentinel parallel-syncs &lt;master-name> &lt;numslaves></span>
sentinel parallel-syncs mymaster 1



<span class="token comment" spellcheck="true"># 故障转移的超时时间 failover-timeout 可以用在以下这些方面： </span>
<span class="token comment" spellcheck="true">#1. 同一个sentinel对同一个master两次failover之间的间隔时间。</span>
<span class="token comment" spellcheck="true">#2. 当一个slave从一个错误的master那里同步数据开始计算时间。直到slave被纠正为向正确的master那里同步数据时。</span>
<span class="token comment" spellcheck="true">#3.当想要取消一个正在进行的failover所需要的时间。  </span>
<span class="token comment" spellcheck="true">#4.当进行failover时，配置所有slaves指向新的master所需的最大时间。不过，即使过了这个超时，slaves依然会被正确配置为指向master，但是就不按parallel-syncs所配置的规则来了</span>
<span class="token comment" spellcheck="true"># 默认三分钟</span>
<span class="token comment" spellcheck="true"># sentinel failover-timeout &lt;master-name> &lt;milliseconds></span>
sentinel failover-timeout mymaster 180000

<span class="token comment" spellcheck="true"># SCRIPTS EXECUTION</span>

<span class="token comment" spellcheck="true">#配置当某一事件发生时所需要执行的脚本，可以通过脚本来通知管理员，例如当系统运行不正常时发邮件通知相关人员。</span>
<span class="token comment" spellcheck="true">#对于脚本的运行结果有以下规则：</span>
<span class="token comment" spellcheck="true">#若脚本执行后返回1，那么该脚本稍后将会被再次执行，重复次数目前默认为10</span>
<span class="token comment" spellcheck="true">#若脚本执行后返回2，或者比2更高的一个返回值，脚本将不会重复执行。</span>
<span class="token comment" spellcheck="true">#如果脚本在执行过程中由于收到系统中断信号被终止了，则同返回值为1时的行为相同。</span>
<span class="token comment" spellcheck="true">#一个脚本的最大执行时间为60s，如果超过这个时间，脚本将会被一个SIGKILL信号终止，之后重新执行。</span>

<span class="token comment" spellcheck="true">#通知型脚本:当sentinel有任何警告级别的事件发生时（比如说redis实例的主观失效和客观失效等等），将会去调用这个脚本，</span>
<span class="token comment" spellcheck="true">#这时这个脚本应该通过邮件，SMS等方式去通知系统管理员关于系统不正常运行的信息。调用该脚本时，将传给脚本两个参数，</span>
<span class="token comment" spellcheck="true">#一个是事件的类型，</span>
<span class="token comment" spellcheck="true">#一个是事件的描述。</span>
<span class="token comment" spellcheck="true">#如果sentinel.conf配置文件中配置了这个脚本路径，那么必须保证这个脚本存在于这个路径，并且是可执行的，否则sentinel无法正常启动成功。</span>
<span class="token comment" spellcheck="true">#通知脚本</span>
<span class="token comment" spellcheck="true"># sentinel notification-script &lt;master-name> &lt;script-path></span>
  sentinel notification-script mymaster /var/redis/notify.sh

<span class="token comment" spellcheck="true"># 客户端重新配置主节点参数脚本</span>
<span class="token comment" spellcheck="true"># 当一个master由于failover而发生改变时，这个脚本将会被调用，通知相关的客户端关于master地址已经发生改变的信息。</span>
<span class="token comment" spellcheck="true"># 以下参数将会在调用脚本时传给脚本:</span>
<span class="token comment" spellcheck="true"># &lt;master-name> &lt;role> &lt;state> &lt;from-ip> &lt;from-port> &lt;to-ip> &lt;to-port></span>
<span class="token comment" spellcheck="true"># 目前&lt;state>总是“failover”,</span>
<span class="token comment" spellcheck="true"># &lt;role>是“leader”或者“observer”中的一个。 </span>
<span class="token comment" spellcheck="true"># 参数 from-ip, from-port, to-ip, to-port是用来和旧的master和新的master(即旧的slave)通信的</span>
<span class="token comment" spellcheck="true"># 这个脚本应该是通用的，能被多次调用，不是针对性的。</span>
<span class="token comment" spellcheck="true"># sentinel client-reconfig-script &lt;master-name> &lt;script-path></span>
sentinel client-reconfig-script mymaster /var/redis/reconfig.sh <span class="token comment" spellcheck="true"># 运维配置</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2><span id="shi-san-huan-cun-chuan-tou-he-xue-beng-mian-shi-gao-pin-gong-zuo-chang-yong">十三、缓存穿透和雪崩（面试高频，工作常用）</span><a href="#shi-san-huan-cun-chuan-tou-he-xue-beng-mian-shi-gao-pin-gong-zuo-chang-yong" class="header-anchor">.</a></h2><blockquote>
<p>这里仅仅是了解，不涉及解决方案底层</p>
</blockquote>
<p>Redis缓存的使用，极大的提升了应用程序的性能和效率，特别是数据查询方面。但同时，它带来了一些问题。其中最要害的问题，就是数据一致性问题，从严格意义上讲，这个问题无解。如果对数据的一致性要求很高，那么就不能使用缓存。另外的一些典型问题就是，<strong>缓存穿透</strong>、<strong>缓存雪崩</strong>和<strong>缓存击穿</strong>。目前，业界也都有比较流行的解决方案。</p>
<h3><span id="1-huan-cun-chuan-tou-cha-bu-dao">1、缓存穿透（查不到）</span><a href="#1-huan-cun-chuan-tou-cha-bu-dao" class="header-anchor">.</a></h3><p>缓存穿透：用户想要查一个数据，发现Redis内存数据库中没有，也就是<strong>缓存没命中，于是向持久层数据库查询。发现也没有，于是本次查询失败</strong>。当用户很多时，缓存都没有命中（秒杀！），于是都去请求持久层数据库。这会导致持久层数据库造成很大的压力，这时候就相当于出现了缓存穿透。</p>
<h4><span id="jie-jue-fang-an">解决方案</span><a href="#jie-jue-fang-an" class="header-anchor">.</a></h4><h5><span id="bu-long-guo-lu-qi">布隆过滤器</span><a href="#bu-long-guo-lu-qi" class="header-anchor">.</a></h5><p>布隆过滤器是一种数据结构，对所有可能查询的参数以Hash形式存储，在控制层先进行校验，不符合则丢弃，从而避免存储系统的查询压力。</p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131751.png" alt></p>
<h5><span id="huan-cun-kong-dui-xiang">缓存空对象</span><a href="#huan-cun-kong-dui-xiang" class="header-anchor">.</a></h5><p>当存储层不命中后，即使返回的空对象也将其缓存起来，同时会设置一个过期时间，之后再访问这个数据将会从缓存中获取，保护了后端数据源</p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131755.png" alt="image-20201118094132029"></p>
<p><strong>但是这个方法会存在两个问题</strong></p>
<ul>
<li>如果空值能够被缓存起来，这就意味着缓存需要更多的空间存储更多的键，因为这当中可能会有很多的空值的键</li>
<li>即使空值设置了过期时间，还会存在缓存层和存储层的数据会有一段时间窗口的不一致，这对于需要保持一致性的业务会有影响</li>
</ul>
<h3><span id="2-huan-cun-xue-beng-ji-zhong-shi-xiao">2、缓存雪崩（集中失效）</span><a href="#2-huan-cun-xue-beng-ji-zhong-shi-xiao" class="header-anchor">.</a></h3><p>缓存雪崩，是指在某一时间段，缓存集中过期失效。Redis宕机！</p>
<p><strong>产生原因之一：</strong></p>
<p>比如，双十一零点抢购，会把同一批商品信息比较集中的放入缓存中，假设缓存设置一个小时的过期时间，那么到凌晨一点钟的时候，这批商品的缓存就都过期了。而对这批商品的访问查询，都落到了数据库上，对于数据库而言，就会产生周期性的压抑波峰。于是所有的请求就会向存储层，存储层的调用量会暴增，<strong>可能</strong>造成存储层奔溃，服务器宕机。</p>
<p><img src="https://liuyou-images.oss-cn-hangzhou.aliyuncs.com/markdown/20201119131802.png" alt="image-20201118094811319"></p>
<p>其实集中过期，倒不是非常致命，<strong>比较致命的缓存雪崩，是缓存服务器某个结点宕机或断网</strong>。因为自然形成的缓存雪崩，一定是在某个时间段集中创建缓存，这个时候，数据库也是可以顶住压力的。无非就是对数据库产生周期性的压力而已。而<strong>缓存服务节点的宕机，对数据库服务器造成的压力是不可预知的，很可能瞬间就把数据库压垮。</strong></p>
<h4><span id="jie-jue-fang-an">解决方案</span><a href="#jie-jue-fang-an" class="header-anchor">.</a></h4><h5><span id="redis-gao-ke-yong">Redis高可用</span><a href="#redis-gao-ke-yong" class="header-anchor">.</a></h5><p>这个思想含义是，既然Redis有可能挂到，那我们多增设几台Redis，这样挂掉之后其他的还可以继续工作，其实就是<strong>搭建集群</strong></p>
<h5><span id="xian-liu-jiang-ji">限流降级</span><a href="#xian-liu-jiang-ji" class="header-anchor">.</a></h5><p>这个解决方案的思想是，在缓存失效后，通过加锁或队列来控制读数据库写缓存的线程数量。比如对某个key只允许一个线程查询数据和写缓存，其他线程等待。</p>
<h5><span id="shu-ju-yu-re">数据预热</span><a href="#shu-ju-yu-re" class="header-anchor">.</a></h5><p>数据加热的含义就是在正式部署之前，我们先把数据先预先访问一遍，这样部分可能大量访问的数据就会加载到缓存中，在即将发生大并发访问<strong>手动触发加载缓存不同的key</strong>，设置不同的过期时间，让缓存失效的时间点尽量均匀。</p>
<h3><span id="3-huan-cun-ji-chuan-cha-xun-liang-tai-da-huan-cun-guo-qi-shun-jian">3、缓存击穿（查询量太大，缓存过期瞬间）</span><a href="#3-huan-cun-ji-chuan-cha-xun-liang-tai-da-huan-cun-guo-qi-shun-jian" class="header-anchor">.</a></h3><p>这里需要注意和缓存穿透的区别，缓存击穿：是指一个key非常热点，在不停的扛着大并发，大并发集中对一个点进行访问，当这个key在失效的瞬间，执行的大并发就穿破缓存，直接请求持久层数据库，就像在一个屏幕上凿开一个洞。</p>
<p>当某个key在过期瞬间，有大量的请求并发访问，这类数据一般是热点数据，由于缓存过期，会同时访问数据库来查询最新数据，并且回写缓存，会导致数据库瞬间压力过大。</p>
<h4><span id="jie-jue-fang-an">解决方案</span><a href="#jie-jue-fang-an" class="header-anchor">.</a></h4><h5><span id="she-zhi-re-dian-shu-ju-yong-bu-guo-qi">设置热点数据永不过期</span><a href="#she-zhi-re-dian-shu-ju-yong-bu-guo-qi" class="header-anchor">.</a></h5><p>从缓存层面，没有设置过期时间，所以不会出现热点key过期后产生的问题。</p>
<h5><span id="jia-hu-chi-suo">加互斥锁</span><a href="#jia-hu-chi-suo" class="header-anchor">.</a></h5><p>分布式锁：使用分布式锁，保证对于每个key同时只能有一个线程去查询后端服务，其他线程没有获得分布式锁的权限，因此只需要等待即可。这种方式将高并发的压力转移到了分布式锁，因此分布式锁的考验很大。</p>

            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://www.liuminkai.top" rel="external nofollow noreferrer">liuminkai</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://www.liuminkai.top/2020/11/02/9349.html">http://www.liuminkai.top/2020/11/02/9349.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="http://www.liuminkai.top" target="_blank">liuminkai</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Redis/">
                                    <span class="chip bg-color">Redis</span>
                                </a>
                            
                                <a href="/tags/NoSQL/">
                                    <span class="chip bg-color">NoSQL</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//libs/gitalk/gitalk.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '4e04421bf007cd448eb3',
        clientSecret: '98d0aaec7d39c4c8ba7ef6118575f68eafc77951',
        repo: 'blogtalk',
        owner: 'liuminkai-blog',
        admin: ["liuminkai-blog"],
        id: '2020-11-02T13-15-41',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2020/11/07/44409.html">
                    <div class="card-image">
                        
                        
                        <img src="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//medias/featureimages/14.jpg" class="responsive-img" alt="学习GitHub看这一篇就够了">
                        
                        <span class="card-title">学习GitHub看这一篇就够了</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            GitHub学习笔记.
之前对git学习只是简单的了解了下命令，但是很容易就忘记，因此写下这篇文章记录下git学习过程以及实践

git提交步骤：

git init //初始化仓库
git add .(文件name) //添加文件到本地仓
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-11-07
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-category">
                                    学习笔记
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/git/">
                        <span class="chip bg-color">git</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/10/25/30335.html">
                    <div class="card-image">
                        
                        
                        <img src="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//medias/featureimages/13.jpg" class="responsive-img" alt="linux常用命令">
                        
                        <span class="card-title">linux常用命令</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Linux 常用命令.文件操作命令.1、文件处理命令.ls [选项] [参数].
list 列出参数的属性信息

参数为路径名
常用选项



选项
说明



- l
显示目录下详细的文件信息，可简化为 ll


- a
显示目录下全部文
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-10-25
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-category">
                                    学习笔记
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/linux/">
                        <span class="chip bg-color">linux</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->


<!-- 代码块复制 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->


<script src="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4, h5, h6'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4, h5, h6').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2020</span>
            <a href="http://www.liuminkai.top" target="_blank">liuminkai</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">281.1k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/kaiminliu" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:liuyou2021@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>




    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1423928650" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1423928650" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//search.xml", 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//libs/materialize/materialize.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//libs/masonry/masonry.pkgd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//libs/aos/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//js/matery.js"></script>

    <!-- Baidu Analytics -->

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//libs/others/busuanzi.pure.mini.js"></script>
    

    

	
    

    

    

    

    
    <script src="https://cdn.jsdelivr.net/gh/liuminkai-blog/liuminkai-blog.github.io//libs/instantpage/instantpage.js" type="module"></script>
    
	
	
	<!-- 一言API -->
	<!-- 现代写法，推荐 -->
	<!-- 兼容低版本浏览器 (包括 IE)，可移除 -->
	<script src="https://cdn.jsdelivr.net/npm/bluebird@3/js/browser/bluebird.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/whatwg-fetch@2.0.3/fetch.min.js"></script>
	<!--End-->
	<script>
	  fetch('https://v1.hitokoto.cn')
		.then(function (res){
		  return res.json();
		})
		.then(function (data) {
		  var hitokoto = document.getElementById('hitokoto');
		  hitokoto.innerText = data.hitokoto + '——【' + data.from + '】';
		})
		.catch(function (err) {
		  console.error(err);
		})
	</script>
</body>

</html>
